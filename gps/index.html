<!doctype html>
<html lang=zh_tw.UTF-8 manifest="index.manifest">
<head>
	<meta charset="utf-8">
	<!-- 程式來源 https://blog.xuite.net/gkyo0510/wretch/242769650 -->
	<title>GPS02-2</title>
</head>

<style>  
	.cmdButton {
		width:200px;
		height:200px;
		border-width:3px;
		border-style:dashed;
		border-color:#FFAC55;
		padding:5px;
		
		text-align:center;	//水平置中
		top:0px;
		line-height:200px;//文字垂直置中(行高等於容器高度),單行適用
	}  
</style>  

<body onload="init();" bgcolor="black" text="white" margin="0">
	<f function HTML_body(){}/>
	<a>v0.83</a>
	<input type="button" value="測試" onClick="test03();">
	<br>
	<canvas id="canvas"></canvas>
	<font size="7">
	<div style="display: flex; justify-content: flex-end;">
		<div class="cmdButton" onclick="nearPoint();" >尋標</div>
		<div class="cmdButton" onclick="insertCoord('急彎');">急彎</div>  
		<div class="cmdButton" onclick="insertCoord('測速');">測速</div>
		<div class="cmdButton" onclick="nearPoint();	">尋標</div>
		<div class="cmdButton" >
			<div id="march" onclick="swColor();" style="font-size: 150px;">0</div>
		</div>
	</div>
		
	<p id="posStr">111222</p>
	</font>
	<font size="6">
	<p id="watchStr">監控狀態</p>
	</font>
	<input type="checkbox" id="touchSW" checked>觸控
	<input type="button" value="GPS啟動" onClick="startGPS();">
	<input type="button" value="GPS停止" onClick="stopGPS();">
	<input type="button" value="更新快取" onClick="newCache();">
	<input type="button" value="通知測試" onClick="displayNotification();">
	<input type="button" value="清除軌跡數據" onClick="ins.innerHTML='';localStorage.insertCoord='';">
	
	<input type="button" value="匯出" onClick="exportCoord();">
	<input type="file" multiple id="input" style___='display:none;'>
	
	<p id="insertCoord"></p>
</body>
<script defer>
	//defer:資源載入後才執行, async同, 但不保證照順序, 空白則立即執行,
	//等同 window.addEventListener('load', function() {...}
    if ('serviceWorker' in navigator) {
		navigator.serviceWorker.register('sw.js')	//參數scope設定掌管範圍, 預設為???
		.then(reg => console.log('完成 SW 設定!', reg))
            .catch(err => console.log('Error!', err));
		//sw.js須為獨立檔案, 無法把程式全部塞在一個檔案。
		
		navigator.serviceWorker.addEventListener("message", function(event) {
			showMsg(event.data);
		});
    }
</script>
<script>
//TODO 到指定網站下載gps檔(並cache)
function var_tasks(){ }//本行給notepad++的函式清單用(大引號不可靠在一起)
var tasks = [[																	//廣東路
		[22.683493730273277, 120.49835715263679, "廣東路_仁愛路口","號誌",,"號誌"],
		
		[22.681135369442668, 120.50103519150333, "大連路","號誌",,"號誌"],
		[22.680503680227538, 120.50166215785417, "468巷","號誌",,"號誌"],
		[22.68001666152951, 120.50172601825584, "456巷","號誌",,"號誌"],
		[22.67709462074551, 120.50092146003797,"建豐路","號誌",,"號誌"],
		[22.676454250884152, 120.50072968208876, "勝利路","號誌",,"號誌"],
		[22.676016199057848, 120.50058752501798, "高豐街","號誌",,"號誌"],
		[22.674161811466448, 120.49996566902554,"民學路","號誌",,"號誌"],
		[22.671873370117144, 120.49922917511516, "公園路","號誌",,"號誌"],
		[22.671026831904392, 120.49895754739023,"林森路","號誌",,"號誌"],
		[22.670303645732268, 120.4987238326765, "民和路","號誌",,"號誌"],
		[22.669749249959157, 120.49854948908974, "師校巷","號誌",,"號誌"],
		[22.668284679096782, 120.49808161964651, "民利路","號誌",,"號誌"],
		
		[22.667523721107013, 120.4978306934891, "民生路","號誌",,"號誌"],
		[22.666146373148113, 120.49682535519977, "永興巷","號誌",,"號誌"],
		[22.66566842646139, 120.49611878921134, "民有一路","號誌",,"號誌"],
		[22.66449445724402, 120.49398889788802, "台糖三街","號誌",,"號誌"],
		[22.66453848649853, 120.4927585499102, "台糖二街","號誌",,"號誌"],
		[22.66471906690055, 120.49111327623315, "台糖一街","號誌",,"號誌"],
		[22.664921862823768, 120.49002489997704, "仁愛路","號誌",,"號誌"],
		[22.66524429343796, 120.4884874696773, "廣東路_復興路口","號誌",,"號誌"]
		
	],[
																					//民生路
		[22.67151428266995, 120.4783177394244, "民族和平路口","號誌",,"號誌"],
		[22.670291616624766, 120.4864197382896, "民族中正路口","號誌",,"號誌"],
		[22.67113062321537, 120.48921382369929, "民生逢甲路口","號誌",,"號誌"],
		[22.6703935686598,		120.49122460092052, "民權路"],
		[22.67008860646881,		120.49209548031308, "仁愛路"],
		[22.669222036792192, 120.49452819798431, "自由路","號誌",,"號誌"],
		[22.669049328652985, 120.49498868304266, "自立路"],
		[22.668690566737276, 120.49578050428205, "民和路"],
		[22.667523721107013, 120.4978306934891, "廣東路G50R40","號誌",,"號誌"],
		
		[22.66665111203367, 120.49936391934412, "民教路G60R40"],
		[22.6660872645837,		120.50037043288955,	"工業路G60R40","號誌",,"號誌"],
		[22.665707901738443,	120.5010424041541,	"69巷","路口"],		
		[22.66528466599206,		120.5017954343364,	"殺蛇溪", "號誌"],
		[22.665066241181687, 120.50217027304704, "民福路G60R40",,,"號誌"],
		[22.6642219442753, 120.50369274070279, "民生校區"],
		[22.66339089234732, 120.50520474477672, "菸廠路"],
		[22.66279229323675, 120.50623662222313, "瑞民路演藝廳"],
		
		[22.662224974588675, 120.50727148282286, "歸仁路G50R40", "號誌",,"號誌"],
		[22.660783934931143, 120.50977659008726, "瑞屏街中油"],		
		[22.65990848834937, 120.51121889337335, "民生路_和生路口G60R40"]
	],[																					//田中巷
		[22.659470893607228, 120.51209569251994, "安心四橫巷", "路口",,"路口"],
		[22.65982669905339, 120.51235318458225, "田中巷口", "路口",,"路口"],	
		[22.65956412062677, 120.5130726983204, "二橫巷","測速",,"測速"],
		[22.659505837597436, 120.5143833817605, "2-10號", "休息站",, "休息站"],
		[22.659390282100908, 120.51514639840148, "瑞光路口", "路口",,"路口"],

	],[																					//瑞光路
		[22.652150360224123, 120.51053770124854, "瑞光路_歸禮巷","路口",,"路口"],
		[22.653399707004777,120.51195347112373, "民生東路11巷","路口",,"路口"],
		[22.654285266265962,120.51290058024507, "歸智巷","路口",,"路口"],
		[22.655579780727386, 120.51407578585876, "彎10"],
		[22.658030217493362, 120.514628916623, "國仁路口", "號誌",, "號誌"],
		[22.658633168724144, 120.51504245069331, "彎(急診室)"],
		// [22.659389112309576, 120.51514843327135,"田中巷口","號誌"],
		[22.66042539472848, 120.5153220745,"單車道", "號誌",,"號誌"],
		[22.661457518466925, 120.51546704670002, "彎20"],
		[22.665190350620573, 120.51312797662538,"香揚巷口", "號誌",,"號誌"],
		[22.669040797908576, 120.51069667037709, "彎30"],
		[22.670996612762544, 120.51062443057785, "民學路", "號誌",,"號誌"],
		[22.673650031059577, 120.51056656006223, "田寮巷", "號誌",,"號誌"],
		[22.675343791402256, 120.51041230398191, "彎40"],
		[22.676452289680334, 120.50955647049913, "建豐路", "號誌",,"號誌"],
		[22.678966094896705, 120.50732545840168, "興豐路", "號誌",,"號誌"],
		[22.679781531852086, 120.50662226896395, "146巷", "號誌",,"號誌"],
		[22.680967230062606, 120.5055987046144, "彎60"],
		[22.68296750430608, 120.50505775656028, "大連路", "號誌",,"號誌"],
		[22.68489551063569, 120.50453366820194, "17弄", "號誌",,"號誌"],
		[22.687119793082346, 120.50397282994732, "華正路口", "號誌",,"號誌"],
		[22.689404000290573, 120.50339964016158, "華新路", "號誌",,"號誌"],
		[22.6925738066444, 120.50228411988692, "中正路", "號誌",,"號誌"],
		[22.6975656929976, 120.49934616305569,"瑞光路_忠孝路", "號誌",,"號誌"]
	],[																					//海豐
		[22.692732317780546, 120.50245954225517,"海豐街", "號誌",,"號誌"],
		[22.695511971450234, 120.5054161117716,	 "盛豐路", "號誌",,"號誌"],
		[22.696883960767217, 120.50906180826027,"18巷", "號誌",,"號誌"],
		[22.69722359582506, 120.51001791729799, "彎23"],
		[22.697520399914552, 120.51273661749624, "彎27"],
		[22.698434438925595, 120.5144862524928,	 "XX巷", "號誌",,"號誌"],
		[22.70063485997485, 120.51823386201329, "彎47"],
		[22.701582376471514, 120.51924180789028, "彎57"],
		// [22.701152592239588, 120.51891439357674, "彎道"],
		[22.702703598302563, 120.51973392246246, "屏34", "號誌",,"號誌"],
		[22.705400301590082, 120.52084164949027, "屏XX", "號誌",,"號誌"],
		[22.706893006935474, 120.52142952458101,"彎水溝"],
		[22.70880261417915,	 120.52199195978083, "德和路台27", "號誌",,"號誌"],
		[22.7151486520024,	 120.52903378461157, "海豐交路口", "號誌",,"號誌"]
	],[																					//國三
		[23.520061183314333, 120.4847024636855, "國3_竹崎290k"],
		[23.45071281050385, 120.48482435360481, "中埔297k"],
		[23.44499391816726, 120.48255061130372, "中埔北出",,,"交流道"],
		[23.428426834321836, 120.46796253994576, "水上系統300k(台82)"],
		[23.347261953768577, 120.43948351735621, "白河311k"],
		[23.34062022508645, 120.43785061223615, "白河北出[南172]",,,"交流道"],
		[23.32962490710023, 120.432161080154, "測速南313.7k白河收","測速"],
		[23.296923372435128, 120.40465436441492, "測速北318.7k",,,"測速"],
		[23.288115881113587, 120.39725679818166, "東山休319k"],
		[23.2709768935784, 120.37879506296973, "柳營322k"],
		[23.259032533296, 120.3761323379591,"柳營北出",,,"交流道"],
		[23.212595587038756, 120.3559797848179, "六甲329k"],
		[23.200949352616856,120.35551792420067,"測速北331K",,,"測速"],
		[23.166488394497204, 120.35211069151072,"官田系統334k(台84)"],
		
		[23.123680009773498, 120.33163907200299, "善化340k"],
		[23.106145617196557, 120.32773179091218, "測速南342.1k善化收","測速"],
		[23.083334391223495,120.3292765621875,"測速北344.7k",,,"測速"],
		[23.064405390029275, 120.32385819692153, "新化系統346k"],
		[23.055614880035566, 120.3213650686524,"新化系統北出(國8)",,,"交流道"],
		[23.031102013773342, 120.3274716309712,"新化休350k"],
		[23.002538936297594, 120.32017197763913, "彎354k路橋"],
		[22.98198929030237, 120.32137500437895, "關廟南出(台86)","交流道"],
		[22.976988169199117, 120.32451457757003, "關廟357"],		//不算「系統」交流道
		[22.972969515201683, 120.33025066426973,"關廟北出(台86)",,"s","交流道"],
		[22.970843068872675,120.33799371432511,"測速南358.6k","測速"],
		[22.95513577884162, 120.35215292962923, "彎46"],
		[22.928409690316805, 120.35144861748418, "關廟休363k"],
		[22.880475806969113, 120.3605339960465, "田寮369k"],
		
		[22.85886879087182, 120.37342920505114, "測速南372.3k田寮收","測速"],
		[22.844973482678757,120.38563347460189,"測速北374.3k",,,"測速"],
		[22.826030483069918, 120.41562147126878, "彎/中寮隧道北"],
		
		[22.784742294477663, 120.4261437839069,"燕巢系統383k"],	
		[22.767044225195598, 120.44657768105789, "測速南386k斜張北","測速"],
		[22.75729335970399,120.47697660868005,"測速北389.3k",,,"測速"],
		[22.75358750782007, 120.49164156529784, "九如391k"],
		[22.715142111757505, 120.52903480114699, "鹽埔396k"],
		[22.696340598015862, 120.5553899586657, "長治400k"],
		[22.68493499943817, 120.56275716716313, "彎35"],
		[22.651404539183083, 120.5461149478058, "麟洛南出","交流道","s"],
		[22.638461295240916, 120.5377207690429, "麟洛407k"],
		[22.57146000799331, 120.52805817563673, "國3_竹田系統415k"]
	],[
		[22.651404539183083, 120.5461149478058, "麟洛南出"],
		[22.648871967617648, 120.54400312679464, "彎1"],
		[22.647870943228924, 120.54325403791405, "彎2"],
		[22.643702797709295, 120.5405143484962, "彎3",,"s"]
	],[
		[23.5534635024959, 120.41575260224359, "國1_民雄257k"],
		[23.494853866352237, 120.39151776091767, "嘉義264k"],
		//測速北261.7大
		[23.485188208883738, 120.38434099171512, "國1_太保北上",,,"交流道"],
		[23.444469495481073, 120.36693865260786, "水上270k"],
		[23.424581019743666, 120.35661493424698,"嘉義系統272k(台82)"],
		//南276.2,
		[23.38475010009152,120.35490877975793,"測速照相北277.3","測速"],	
// 南279,		
		[23.3822240097334, 120.35422460954936, "彎陸橋南84"],
		[23.35803491965871, 120.33825254669834, "新營收費站"],
		[23.339912448572896, 120.3121423175039, "新營休284k"],
		//測速北284.1
		[23.33198231006068,120.30501881737331, "測速南285.3k","測速"],
		[23.30732464446435, 120.29080890577876, "新營288k"],
		[23.276397443199087,120.26939895183537,"測速北292.5k",,,"測速"],
		[23.27199334518172,120.2651591757541,"測速南293.1k","測速"],
		[23.219142537160913, 120.23911067598834, "下營系統299k(台84)"],
		//測速北301.5
		[23.201338264985267,120.23635636202462,"測速南301.6k","測速"],
		
		[23.191613212788408, 120.23620573095596, "麻豆南出","交流道"],
		[23.182400329087255, 120.23565584201334, "麻豆303k"],
		[23.161191707112035,120.2309924396999,"測速南306.1k","測速"],
		//測速北309.1
		[23.117642743896905, 120.24356043591008, "安定311k"],
		[23.08579196837314, 120.25127435443811, "台南系統南下出口","交流道"],
		[23.079167471361096, 120.25221238322186, "台南系統315k(國8)"],
		//測速南315.5k
		[23.041946983666293, 120.25145678714567, "永康319k"],
		//測速南321.8k
		//測速北323.4
		[23.003008726296116, 120.24810377094597, "大彎324k復國二路16巷"],
		[22.97217793072726, 120.24939759796331, "仁德327k&327A北出"],
		[22.935994105128767, 120.2523956860487,"仁德系統330k北出",,,"交流道"],
		[22.914948593133833,120.2617257085907, "測速北334k",,,"測速"],
		[22.90574129034984, 120.26585983467193, "仁德休335k"],
		[22.892223406291862,120.27244880447584, "測速北336.7k",,,"測速"],
		[22.879590258074288, 120.2791994070347, "路竹338k"],
		[22.845846254754292, 120.2953351156559, "高科342k"],
		[22.812226242941332, 120.31425831237283, "岡山收"],
		[22.78783547514928, 120.32063020173459, "岡山349k"],
		[22.75491671257207,120.33354986728632, "測速北353.3k",,,"測速"],
		[22.74197214663059, 120.3344210662114, "楠梓南出","交流道"],
		// [22.737139874816485, 120.33445440802357, "楠梓北356k(台22)"],
		[22.72095165324913, 120.33240548078585,  "楠梓南356K(高183)"],
		[22.675247074423822, 120.32899256604684, "國1_鼎金系統362(國10)"]
		//測速北373.4
	],[
	
		[23.498811449552825, 120.38288491422452, "太保南新里_222巷"],
		[23.4986063263779, 120.38520189457698, "中正路","路口",,"路口"],
		[23.49630107347438, 120.38416099243679, "中興路","路口",,"路口"],
		[23.496270565279907, 120.38631794807313, "彎10"],
		[23.494853496860227, 120.3915164129312, "交流道下"],
		[23.492706322464482, 120.39599941250182, "竹子腳","號誌",,"號誌"],
		[23.491956262844052, 120.39788090234289, "埤竹路","測速",,"號誌"],
		[23.489943215651362, 120.40456492707779, "保福一路","號誌",,"號誌"],
		[23.489334512692835, 120.40658318765735, "保福路","號誌",,"號誌"],
		[23.48731202160997, 120.41327505915952, "朱子公廟","號誌",,"號誌"],
		[23.48604800115588, 120.41739653616519, "大溪路","號誌",,"號誌"],
		[23.485249060748945, 120.41994939762375, "北社尾路","號誌",,"號誌"],
		[23.484369600623886, 120.42271417604084, "世賢路","號誌",,"號誌"],
		
		[23.48328376485415, 120.4245887021208, "興逹路","路口",,"路口"],
		//[23.483927683653253, 120.4250500420696, "泰X一街"],
		[23.484635821373992, 120.42522095393483,"泰源二街","路口",,"路口"],
		//[23.484780203725695, 120.42696779667376, "泰瑞四街"],
		[23.484866693493874, 120.42777223992623, "四維路","號誌",,"號誌"],
		[23.48509932882059, 120.4307495344369, "八德路","號誌",,"號誌"],
		[23.485371164554195, 120.43350202929254, "友愛路","號誌",,"號誌"],
		[23.485603254636477, 120.43598669750823, "建國路","路口",,"路口"],
		[23.48770015030503, 120.43798908763151, "自由路","路口",,"路口"],
		[23.484586211810406, 120.44207576963485, "博愛路","號誌",,"號誌"],
		[23.48240266932118, 120.44483303135881, "彎22"],
		[23.481954059682657, 120.44593703182586, "民生北路","路口",,"路口"],
		[23.48215631410741, 120.44911616103315, "文化路","號誌",,"號誌"],
		[23.48278232126051, 120.45247972217649, "民權吳鳯路口","號誌",,"號誌"],
		[23.483027545683317, 120.45392515642074, "民權忠孝路口","路口",,"路口"],
		[23.48157263002843, 120.45410415844404, "中山忠孝路口","號誌",,"號誌"],
		[23.48074726703351, 120.45423290447764, "民樂街","路口",,"路口"],
		
		[23.48061568219607, 120.45304999770407, "吳鳳北路","路口",,"路口"],
		[23.481385310071623, 120.45289189851603, "吳鳳中山路口","路口",,"路口"],
		[23.479998027679155, 120.4498387221425, "噴水池D2"],
		[23.479905810607335, 120.44942608572478, "噴水池D9"],
		[23.479614529944225, 120.446227135202, "民生中山路口","路口",,"路口"],
		[23.480566454376916, 120.44610458917927, "嘉義市_民生北榮街口"]
	],[
		[23.48157263002843, 120.45410415844404, "嘉市_中山忠孝路口","號誌",,"號誌"],
		[23.4818288302943, 120.45620328583118, "和平路"],
		[23.48213699581143, 120.45877431121782, "維新路"],
		[23.482410837860353, 120.46102419498591, "新生中山路口","路口",,"路口"],
		[23.47705152340935, 120.46172145903971,"新生民族路口"],
		[23.47501447029405, 120.46170745282507, "垂楊彌陀路口","路口",,"路口"],
		[23.466204220558524, 120.46741761818838, "立仁路"],
		[23.46457107458117, 120.469092231446, "彎10"],
		[23.463957509859572, 120.47036506101428, "彎20"],
		[23.46289692223542, 120.4711096589459, "堤防道路"],
		[23.459378726343754, 120.4714740662981, "忠義大義路口","路口",,"路口"],
		[23.45837153204137, 120.47365160943791, "彎33"],
		[23.453429791666128, 120.47711731886149, "彎44"],
		[23.451287808677645, 120.48008719477666, "大義中山路口","路口",,"路口"],
		[23.450707271245832, 120.48482347296057, "國3下"],
		[23.449944802528346, 120.48825255232322, "中埔交東_富裕路"]
	],[
		[23.185131561721175, 120.24105416030602,"南176_麻豆"],
		[23.18240333534582, 120.2356561677857, "麻豆交"],
		[23.179799407691796, 120.23053900160443, "工業路"],
		[23.176077727002706, 120.21233559290528, "車道縮減","車道縮減"],
		[23.174856531744215, 120.2057855628174, "龍興路"],
		[23.17244323929692, 120.20368427969782, "車道縮減",,,"車道縮減"],
		[23.16934475464802, 120.2017015640541, "彎"],
		[23.163948416334236, 120.18235471843579,"佳東路A"],
		[23.165389855077912, 120.17815692521748, "延平路"],
		[23.165718934097523, 120.17493202856102, "光復路"],
		
		[23.163125179670626, 120.17480113865406, "佳里文化路"],
		[23.162128254867287, 120.17478333728292, "和平街(日寶)","路口",,"路口"],
		[23.15994954649453, 120.1747423026192, "新生路"],
		[23.15512708599309, 120.17535125150587, "仁愛路(烤乳豬)","路口",,"路口"],
		[23.154039981314654, 120.1782238827777, "勝利路"],
		[23.15190687589858, 120.18429166612924, "台19_佳東路B","路口",,"路口"],
		[23.14311001950342, 120.19226738006638, "南44"],
		[23.138545848367894, 120.19571009815844, "南46"],
		
		[23.1275321125773, 120.20202702873107, "新興街","路口"],
		[23.125341523640007, 120.20272218610758, "南34"],
		[23.12260921554261, 120.20307028308838, "西港文化路_南173"],
		[23.121224241617547, 120.20330956078294, "慶安路"],
		[23.11991804712925, 120.20353841567966, "綠川廊道"],
		[23.117550419483656, 120.20388642230876, "忠孝街"],
		[23.11055841015665, 120.20379938803494,"南40"],
		// [23.1064023872731, 120.20573854832975, "西港大橋"
		[23.096615435545832, 120.20949306426802, "南132"],
		[23.089733294555394, 120.21015660371577, "台19_吉安路(國8迴轉)","路口"]
	],[
		[23.080413339742048, 120.19535923568306, "國8西_公學路124巷"],
		[23.0897370627603, 120.2101580927553, "新吉2k(台19)"],
		[23.089499448870555, 120.21743863605131, "新吉西出",,,"交流道"],
		[23.0825999203832, 120.23095059896585, "南133","號誌",,"號誌"],
		[23.079169875340224, 120.25221462582486, "台南系統6k(國1)",,,"交流道"],
		[23.077609137631313, 120.25920154055814, "彎30小路"],
		[23.073108379437986, 120.26745767566945, "彎50南135"],
		[23.062056434287467, 120.28155653737717, "新市9k(台1)"],
		[23.059269741329842, 120.28799388302116, "彎60高鐵"],
		[23.058173258233108, 120.29758567339493, "彎44"],
		[23.060515037038737, 120.30766898882672, "彎77小路"],
		[23.063892216800244, 120.31592546825931, "新化東向出口(國3)","交流道"],
		[23.064403971547915, 120.32385934603009, "新化系統14k(國3)"],
		[23.061362280046982, 120.3318728896584, "國8東_新化端(台20)"]
	
	],[
		[23.34540498369371, 120.4123502582102, "南165白河_富民路"],
		[23.336872237576667, 120.40643167850205, "彎15"],
		[23.328567129804068, 120.4069151519044, "彎11"],
		[23.32614472190241, 120.40515818697484, "東山所前路"],
		[23.32063085356403, 120.4048536186381,"達雲路"],
		[23.318507349252233, 120.40299714640597, "公園路口G25R50","號誌",,"號誌"],
		[23.31062426006925, 120.40028523189007, "測速50","測速"],
		[23.30941176650411, 120.39979334024561,"北馬彎北",,,"急彎"],
		[23.307793557109218, 120.39991497924557, "北馬彎南","急彎"],
		[23.305456147704284, 120.39805962214794 , "彎3"],
		[23.303166207007575, 120.39469089317613, "彎4"],
		[23.30239438188429, 120.39275721478789, "彎2"],
		[23.29493901838239, 120.38556569359515, "東河路口","號誌",,"號誌"],
		[23.293512334998685, 120.38420249588806, "東河急彎"],
		[23.291401183828448, 120.38333622903967, "彎6"],
		[23.283454163556105, 120.3834169629939, "義士路口G35R25","號誌",,"號誌"],
		[23.271978967066747, 120.38387977427587, "彎33"],
		[23.27072646483229, 120.38336295538674, "旭山路口","號誌",,"號誌"],
		[23.26791494025789, 120.38048922441678,"165路口G30R40","路口",,"路口"],
		[23.26558399716798, 120.37828200077855, "南107"],
		[23.258676953695932, 120.37161927501378, "彎34"],
		[23.257944465103648, 120.37148049813736, "南165_果毅"]

	],[
		[22.635849179031137, 120.53125146842204, "屏37_信義路屏監"],
		[22.640091466178593, 120.5362835094121, "台1路口", ,"s", "路口"],
		[22.643808327710612, 120.54063160448442, "國道下R40", "號誌"],
		//[22.646887968356193, 120.54422751976801, "彎道"],	//不在回程路線上
		[22.650260226458116, 120.54568906280016, "民生路g40r40", "號誌",,"號誌"],
		
		[22.655381953796578, 120.55160925823591, "科大路g30r60", "路口",,"路口"],
		[22.653958635505553, 120.56099718185452, "南豐路g40r40","號誌",,"號誌"],
		[22.652601671108002, 120.56930340677384, "彎33"],
		[22.650020204517485, 120.57232527227198, "新生路","號誌"],
		[22.64920952763707, 120.57317083867531,"新生路g40r40",,,"號誌"],
		[22.644074768025085, 120.57842934867084, "測速照相",,,"測速"],
		[22.643333748129898, 120.57925428694658, "大同路口g40r40","號誌",,"號誌"],
		[22.637113564621217, 120.58562488958711, "西銀巷"],
		[22.634758245038586, 120.58804450981617, "科大北路g20r60","號誌",,"號誌"],
		[22.630047211459626, 120.59291416762996, "老埤路口g60r40", "路口",,"路口"],
		
		[22.63165203265637, 120.59484811574646, "福泰路R25"],
		[22.6323789465293, 120.59747736025373, "南山路"],
		[22.633128880246172, 120.59797113670795, "安通路口", "路口",,"路口"],
		[22.634391091432605, 120.6010304853308,   "彎45"],
		[22.633781195307613, 120.60403833875074,  "彎40"],
		[22.634897661413778, 120.60941335733453,  "彎35"],
		[22.633953055967723, 120.61298180239025,  "彎30"],
		[22.63129446897867, 120.61666081562409,  "彎26",,,"急彎"],
		[22.631997564921065, 120.61860851239224, "彎22"],
		[22.62871783050417, 120.62638157350078,"沿山路口", "路口",,"路口"],
		
		[22.62210667218307, 120.62556054399592, "保安路", "號誌",,"號誌"],
		[22.61246586071109, 120.6200526260988, "彎66"],
		[22.604416359284045, 120.62024646947125, "營區路R40","號誌",,"號誌"],
		[22.59858233469853, 120.62046577629641, "測速順向路邊","測速"],
		[22.591721713708438, 120.62115374455101, "佳平路口", "路口","s"],
		[22.580727045914188, 120.62226591938521, "台185_富山路屏106"]
			
	],[	
																				//
		[22.590491294834035, 120.61556295866392, "屏120-1_屏99赤山"],
		[22.591721713708438, 120.62115374455101, "佳平沿山路口",,"s","路口"],																		
		[22.590483410935843, 120.62465695816196,"水泉山公園","急彎",,"急彎"],
		[22.592155787378577, 120.63335669509607,"消防隊","急彎",,"急彎"],
		[22.588965173008408, 120.6347857736698,"彎c21"],
		[22.58463228957156, 120.63724489714178,"彎c22"],
		[22.587393230911395,120.63840873003024,"水溝蓋21","坑洞",,"坑洞"],
		[22.58972948061996, 120.63908090610973, "築夢園"],
		[22.588005635151926, 120.6415262487921, "彎c23"],
		//[22.59124879239625, 120.64225222333936, "彎c24"],
		
		//[22.588014368343007, 120.64156029481664, "彎r3"],
		
		[22.591261095294808, 120.64224973638173, "彎r4"],
		[22.58776454447386, 120.64637982864548, "彎r5"],
		 [22.588052532192496, 120.64697919856708,"112基地"], 
		[22.59007659798934, 120.64766077466638,"橋","急彎",,"急彎"],
		[22.584851943211078, 120.64867308077056, "彎35"],
		[22.58479989669845, 120.64800683736249,  "彎36"],
		[22.582703739665064, 120.64590316103639, "急彎01","急彎",,"急彎"],
		[22.58201392016064, 120.64631005909258, "彎rr4"],
		[22.58156375746854, 120.64774690725149,"急彎02","急彎",,"急彎"],
		[22.58345391607421, 120.64720794662499,"急彎03","急彎",,"急彎"],
		[22.580992567577628, 120.64849052598437,"急彎04","急彎",,"急彎"],
		[22.58305093602287, 120.64777911612705,"急彎05","急彎",,"急彎"],
		[22.58212136208457, 120.64892086114091, "彎05"],
		[22.57838760565134, 120.64971247385891,"坑洞03","坑洞",,"坑洞"],
		[22.57684336447595, 120.65081693697746,"彎52"],
		[22.57559611015127, 120.64970591597994,"彎53"],
		[22.571896220921186, 120.65036759528631,"逍遙山莊","急彎",,"急彎"],
		[22.575496845536147, 120.65052426650247,"彎54"],
		[22.577265781774866, 120.65191606858853,"彎55"],
		[22.578508767064537, 120.65131389357563,"坑洞04","坑洞",,"坑洞"],
		[22.57977995299862, 120.65262972367259,"彎56"],
		[22.582402181267586, 120.65114947459824,"彎57"],
		[22.5852557173229, 120.65335369071546, "拉拔克"],
		[22.585703618189058, 120.65536279400534, "普查卡朗"],
		[22.587315577042794, 120.65691765712258, "水槽"],
		[22.587039118932154, 120.65992939675222,"急彎06水溝蓋","急彎",,"急彎"],
		[22.590629698135977, 120.65974713603376,"急彎07","急彎",,"急彎"],
		[22.590471544673793, 120.66264498498556,"急彎08","急彎",,"急彎"],
		[22.58924109879525, 120.66460999148127, "牌樓","路口",,"路口"],
		[22.593386038796442, 120.67046156816451, "返璞","坑洞",,"坑洞"],
		[22.59369302355945,120.67555271352622,"掉柏油A","坑洞"],
		[22.592239613304425,120.67722900831896,"掉柏油B",,,"坑洞"],
		[22.59176168536461, 120.67935691835952,"貨櫃屋","坑洞"],
		[22.592039093947136,120.6809451159679,"坑洞041","坑洞",,"坑洞"],
		[22.591389196902934,120.68206019691863,"坑洞042","坑洞",,"坑洞"],
		[22.591747368731195,120.68422205249813,"坑洞043","坑洞",,"坑洞"],
		[22.591599051656083, 120.68486212232875, "坑洞05","坑洞",,"坑洞"],
		[22.592177531280022, 120.68483357628378, "坑洞06-1","坑洞"],
		[22.592630575345552,120.68464827381979,"坑洞06-2",,,"坑洞"],
		[22.595115994968776, 120.68506473873026, "觀自在"],
		[22.598383562209477, 120.6845511475299,"彎A3"],
		[22.60230411717502,120.6870893257944,"坑洞77","坑洞",,"坑洞"],
		[22.60650053043042,120.69437563854535,"坑洞","坑洞",,"坑洞"],
		[22.606633881440352, 120.69482779987918, "空地","急彎",,"急彎"],
		[22.60692827794966, 120.69154676474011, "彎A1"],
		[22.607947926654507, 120.691525188623,  "彎A2"],
		[22.610869623490217,120.69874924464474,"坑洞07","坑洞",,"坑洞"],
		[22.6145008,120.7017865,"停車場"],
		[22.615443681182708, 120.70262923538111, "泰武斷崖"]
		],[
	
		[22.61266847075377,120.69993809532149, "日湯真_入口1"],
		[22.61357005644286,120.70124190704566,"彎01"],
		[22.613809573789847,120.70133024558362,"電桿"],
		[22.613880067927372,120.70167639421153,"電桿收費亭"],
				[22.61501512803279,120.70223332448214,"日湯真_入口3","路口"],
		[22.614909280440436,120.70194080706936,"E08"],
		[22.615160672882556,120.70174126247534,"救難繩"],
		[22.61540915743708,120.70172476794434,"E07"],
		[22.61570576407822,120.70167493755383,"E06"],
		[22.61576723763887,120.70151823055944,"E05"],
		[22.616016029163088,120.70162956707567,"E04"],
		[22.616179755198644,120.70150875292673,"E03"],
		[22.616384790371246,120.70106309651935,"E02"],
		// [22.621937370512125,120.70367581710855,"休息站01b"],	//重畳點
		
		


		[22.6163691735652,	120.700999845211,	"水泥底","路口"],
		[22.6163599015386,	120.700640624632,	"電桿18"],
		[22.6163139842759,	120.700408969164,	"電桿20"],
		[22.6165242219495,	120.700230368284,	"電桿22"],
		[22.6168926850124,	120.700365595732,	"電桿24"],
		[22.6173427212350,	120.700532676865,	"電桿26"],
		[22.6175306226832,	120.700784751881,	"電桿32"],
		[22.6177846242491,	120.701007056851,	"電桿34"],
		[22.6180688920823,	120.701179999221,	"電桿36"],
		[22.6183848716357,	120.701237388141,	"電桿42"],
		[22.6188872098394,	120.701461162056,	"電桿44"],
		[22.6191211966622,	120.701622924144,	"電桿46"],
		[22.6193633254871,	120.701665216964,	"電桿52"],
		[22.6195273234284,	120.701946590632,	"電桿54"],
		
		[22.6194132160070,	120.701433175848,	"水泥頂","路口"],		
		[22.619745623676106,120.70154845769152,"點24"],
		[22.61987573054951,120.70177984453117,"點25"],
		[22.6202190084102,	120.701741953508,	"B01"],
		[22.6206172736401,	120.702108474635,	"B02"],
		[22.6206737396570,	120.702341293050,	"樹B03"],
		[22.6211535013205,	120.702602887586,	"B04"],
		[22.6214454128277,	120.702640901423,	"B05"],
		[22.6216204740692,	120.702798114376,	"B06"],
		[22.621708490361264,120.70315987192542,"B07"],

		[22.621937370512125,120.70367581710855,"休息站01","休息站"],
		[22.6221769833546,	120.703645237693,	"C01"],
		[22.6226394404452,	120.703860792467,	"C02"],
		[22.6228473625901,	120.704099273117,	"C03"],
		[22.6230425369283,	120.704076825332,	"C04"],
		[22.6232628506884,	120.704002788845,	"C05"],
		[22.6235184076915,	120.703853850915,	"C06"],
		[22.6237369575310,	120.703684671313,	"C07"],
		[22.6238777627434,	120.703629586829,	"C08"],
		[22.6240410955140,	120.703696069814,	"C09"],
		[22.6247050301199,	120.703853009565,	"C10"],
		[22.6251278814186,	120.704044702069,	"C11"],
		[22.6252901277213,	120.704070781605,	"C12"],
		[22.6256216551517,	120.704193654023,	"C13"],
		[22.6258371071047,	120.704204951326,	"C14"],
		[22.6260677994086,	120.704318429458,	"C15"],
		[22.6261891033439,	120.704325080919,	"C16"],

		[22.626309106974965,120.70441736305555,"c18"],
		// [22.6291667, 120.7019444, "日湯真山"],
		[22.6264667292546,	120.704335983466,	"休息站02","休息站"],
		[22.6270069700570,	120.705182360752,	"D01"],
		[22.6273599984907,	120.705660362859,	"日湯真東出口","路口"],
		[22.6279503741011,	120.707077196570,	"D02"],
		[22.6279873855995,	120.707469745347,	"D03"],
		[22.6276710637854,	120.708156227535,	"D04"],
		[22.6275271373037,	120.708763112585,	"D05"],
		[22.6273095738636,	120.709696223156,	"D06"],
		[22.6271271120597,	120.709918080051,	"D07"],

		[22.626969353569677,120.70990233858107,"D077"],
		[22.62649242983123,120.71049755059374,"崖頂","路口"],
		[22.6260935020491,	120.710756250407,	"D08"],

		[22.6257619269880,	120.711055255301,	"D09"],

		[22.625096216539994,120.71220141454029,"宿舍叉路","路口"],
		[22.6254285274398,	120.713181571455,	"D10"],

		[22.625370031788954,120.71345147109773,"宿舍旁","路口"],
		[22.625661341147897,120.71285853995774,"D11"],
		[22.6265502903681,	120.712467629824,	"D12"],
		[22.6268324101664,	120.712076236941,	"D13"],
		[22.6273234303960,	120.711968861691,	"D14"],
		[22.6278737630738,	120.712140825887,	"D15"],

		[22.6282578294187,120.71216937843494,"水源橋","休息站"],
		[22.625370031788954,120.71345147109773,"宿舍旁重覆","路口"],
		// [22.627910793033372,120.71205956643135,"廁所路口","路口"],
		[22.62494365285559,120.71328892315739,"D16"],
		[22.62508807796253,120.7139035355051,"廁所路口","路口","rep,rcd"],
		[22.624396684841113,120.71457908355855,"管制站路口","路口"],
		// [22.6243669, 120.7148054, "管制站"],
		[22.6242538200133,	120.713870062414,	"電桿90"],
		[22.6239711505707,	120.713466179863,	"電桿89"],
		[22.6240261172705,	120.713102429752,	"電桿88"],
		[22.6238358411943,	120.712913294485,	"電桿87"],
		[22.6239522638566,	120.712515969875,	"電桿86"],
		[22.6243490446910,	120.711944596435,	"電桿85"],
		[22.6240471334875,	120.711264514548,	"電桿84"],
		[22.6249466769935,120.71043541807936,"彎3"],
		[22.6249412959056,	120.708987779579,	"F01"],
		[22.6248504560714,	120.708090057874,	"F02"],
		[22.62481669104701,120.70775806740215,"F03"],
		[22.6244660704494,	120.707741331219,	"F04"],
		[22.624293880894708,120.70710960104269,"F05"],
		[22.62390407570037,120.70669008487421,"F06"],
		[22.6234435703599,	120.706021193544,	"F07"],
		[22.623103262991766,120.70580460932997,"F08"],
		[22.6227022495096,	120.705538375205,	"F09"],
		[22.6225244518828,	120.705338047518,	"F10"],
		[22.6224301712491,	120.705067590307,	"F11"],
		[22.6222412927974,	120.704252010956,	"F12"],
		[22.6220403987036,	120.703897194391,	"F13"],
[22.621937370512125,120.70367581710855,"休息站01重覆"],
[22.6163691735652,	120.700999845211,	"水泥底重覆"],

		[22.6161746477652,	120.700769524142,	"電桿14"],
		[22.616129060822008,120.70069036396335,"A07"],
		[22.61592530608093,120.70049382995761,"彎9"],
		[22.6160598922900,	120.700949171502,	"電桿12"],
		[22.6160748747056,	120.701189618323,	 "彎8"],
		[22.615759048449434,120.70090405496053,"A052"],
		[22.615323498258697,120.70034446042034,"A051"],
		[22.6149756566865,	120.700046136645,	"彎7"],
		[22.615022270899125,120.70047510766796,"A10"],
		[22.615125322335576,120.70104832010698,"A09"],
		[22.615186330141523,120.70158159332216,"彎6"],
		[22.6149245022011,	120.701353061484,	"A08"],
		[22.6148367720409,	120.701366934857,	"A07"],
		[22.6148564063131,	120.701439223749,	"A06"],
		[22.614681305904572,120.7013041857417,"A05"],
		[22.61452300059348,120.70092629107046,"A04"],
		[22.6139824998672,	120.700708728201,	"彎02"],
		[22.614073233966618,120.7008885916784,"A03"],				
		[22.614099298420065,120.70150967046278,"A02"],
		// [22.614169094597326,120.70184175201281,"A01"],


	],[																			//台86,關廟系統
		[22.935834086603325, 120.1763155617751, "台86_西起點"],
		[22.935901191445396, 120.18032485219945, "彎07"],
		[22.93187581171018, 120.19967014322756, "彎裡2K東出",,,"交流道"],
		[22.927658345240154, 120.20405023362777, "彎06"],
		[22.9274917737228, 120.21557065562621, "彎05"],
		[22.932049664423836, 120.22499353058586, "湖內5K東出(台1)",,,"交流道"],
		[22.94375022158827, 120.24336752221714, "彎46"],
		[22.942623194631146, 120.24965817528305, "仁德系統(國1)"],
		[22.940840418075833, 120.25425870332441, "彎04"],
		[22.934595270792208, 120.26099575774114, "上崙交"],
		[22.93226806223255, 120.26736769715247, "彎03"],
		[22.932141687818145, 120.27792017759687, "大潭交11K高鐵"],
		[22.93896574848733, 120.29819182101409, "彎02"],
		[22.94149314730315, 120.30124755313828, "彎01"],
		[22.971278480819183, 120.31327247513406, "測速西",,,"測速"],
		[22.975157067181804, 120.31877334375743, "台19甲","號誌",,"號誌"],
		[22.976705195681916, 120.32280595255693, "同向匯合陸橋",,"s", "靠右"],
		[22.976989521530918, 120.32450692479333, "國道下方"],
		[22.9766912314565, 120.3266473226488,"反向匯合"],
		[22.975325461556306, 120.32744965428243, "反曲點"],
		[22.973940257514684, 120.32848339095966, "台86東_關廟交"]
	],[
		[22.976705195681916, 120.32280595255693, "匣道起點86南下國3同向匯合陸橋"],
		[22.976659929908863, 120.32366393797008, "彎1"],
		[22.976447560215362, 120.32443104974865, "彎2"],
		[22.976447560215362, 120.32443104974865, "彎3"],
		[22.975588200363244, 120.32562195055992, "彎4"],
		[22.97471788502305, 120.32679886237133, "匣道末端86南下國3",,"s"]
	],[
																						//台1台南段
		[23.006205068737728, 120.20609455278554, "台南_西門路北"],
		[23.00657998682059, 120.20727877001934, "70巷意面"],
		[23.007701328798806, 120.20972211923088, "小北路", "路口",,"路口"],
		[23.004520606021483, 120.21078829615375, "公園北路"],
		[23.001008523186776, 120.2087302913892, "公園南路"],
		[22.99806364617843, 120.20694725426088, "成功路"],
		[22.995679245940316, 120.20574519188271, "民族路"],
		[22.9942649436158, 120.20540844288773, "民權路"],
		[22.993017795296343, 120.2051788556002, "圓環北", "號誌",,"號誌"],
		//公園路
		[22.992261192219853, 120.20538560345075, "圓環東南", "號誌",,"號誌"],
		// [22.98495731277926, 120.21114668393643, "開山路",,,"號誌"],
		[22.988965418139585, 120.20765635885944, "府前路"],
		[22.986220791966865, 120.2099089528884, "樹林街"],
		[22.98458384518558, 120.21116379385018, "府連路"], 
		[22.982520880136445, 120.21136638747849, "五妃街"],
		[22.981254574359404, 120.21202626011987, "林森路","號誌"],
		[22.98093008588478, 120.21220250902789, "林森路",,, "號誌"],
		// [22.9807394351853, 120.2123072481083, "大同路100巷", "路口"]
		[22.97629414889348, 120.21394046244464, "大林路"],
		[22.972416153855065, 120.21481356468252, "中華路"],
		[22.964595069946935, 120.21645445767052, "生產路G60","號誌",,"號誌"],
		[22.960437309262627, 120.21697996600106, "保仁路二空"],
		[22.952419382785543, 120.21798832077249, "亞航街前G60",,, "號誌"],
		[22.94405536181032, 120.22033245507691, "文賢路口G60","號誌",,"號誌"],
		[22.941787731378756, 120.22095711150357, "彎02"],
		[22.93992471408244, 120.2210067902625, "測速南路中","測速"],		
		[22.937275501642834, 120.22099726418344, "文華路R40"],
		[22.92962992321998, 120.22092520566011, "86下"],
		[22.922997607021347, 120.22386310277575, "台1台南_保安路"]
	],[
		[22.73663075198599, 120.33403045596671,"楠梓興西路_台22"],
		[22.73037490185727, 120.33386954531063, "興南路"],
		[22.725100451120653, 120.33307316463575, "楠陽路"],
		[22.723001377792222, 120.33252209423672, "經建路"],
		[22.72135026929442, 120.33205487578753, "鳯楠路", "路口"],
		[22.720714405445317, 120.33270586489223, "興西路",,,"路口"],
		
		[22.71736216061651, 120.33489862033673, "33巷"],
		[22.715247527695304, 120.3363680162534, "369巷"],
		[22.714002452851968, 120.33722870005444, "329巷"],
		[22.71288221843651, 120.33793893467126, "竹楠路"],
		[22.709515050654215, 120.34005760080285, "後庄巷"],
		[22.70854763524332, 120.34063221488138, "竹門巷"],
		[22.705893429216697, 120.3422947371487, "高鐵下","號誌",,"號誌"],
		
		[22.70323818936037, 120.3439311286007, "仁信巷"],
		[22.70209388165362, 120.34461045445504, "工業一路"],
		[22.701061433460087, 120.34526960734088, "工業二路"],
		[22.698785605631024, 120.34673099709201, "通法寺"],
		[22.697627181857484, 120.34734787563002, "中華路"],
		[22.696649552816083, 120.34781010891841, "八德一路"],
		[22.69505469979685, 120.3485658334615, "文南二街"],
		[22.694100233852982, 120.34900501024516, "165巷"],
		[22.69310598856217, 120.34946954110053, "新庄路"],
		[22.687821959973167, 120.35195922749112, "名山二街"],
		[22.687373406125644, 120.35220825173393, "彎內四巷"],
		[22.68583127638466, 120.35308910427976, "國10下","號誌",,"號誌"],
		
		[22.68443300910805, 120.35379193222151, "86巷"],
		[22.68169509970025, 120.3552577545618, "仁心路"],
		[22.678481022649738, 120.35709548378601, "南勢巷"],
		[22.676171911346724, 120.35839896631121, "仁勇路"],
		[22.671352882306586, 120.36101772485478, "新生路"],
		[22.669429834212902, 120.36203923990561, "400巷"],
		[22.667879944606803, 120.36261760574801, "東山路"],
		[22.666893626161315, 120.36280701825228, "322巷"],
		[22.665179843684758, 120.36310387765907, "夢裡路"],
		[22.662585364196925, 120.36355126716653, "松埔路"],
		[22.661317259026365, 120.36377586494119, "大仁東路"],
		[22.659092975647592, 120.3641779831732, "神農路口", "路口",,"路口"],
		[22.65931149680357, 120.3656141832518, "48巷"],
		[22.6595200309119, 120.37257845629937, "水管路","號誌",,"號誌"],
		[22.65956599700495, 120.37549773153953, "大榮巷"],
		[22.659446128231913, 120.37976755535666, "松埔路","號誌"],
		[22.65851707133206, 120.38158730665273, "大同路",,,"號誌"],
		[22.656428350452533, 120.38491553053193, "同富街"],
		[22.65505508615313, 120.38607293182085, "131巷"],
		[22.65129302203103, 120.38871064812523, "美德一街"],
		[22.649735877004684, 120.39160124222946, "美山路","號誌",,"號誌"],
		[22.646597139082534, 120.39923267822817, "彎3"],
		[22.645381868139904, 120.40000245536821, "瓦厝街","號誌"],
		[22.64260662922753, 120.40067132197753, "民權街", "路口",,"路口"],
		[22.642718952138992, 120.40485075086903, "江山路北", "路口",,"路口"],
		[22.640184057263603, 120.40523343929571, "鳯屏二路_江山路口", "路口",,"路口"]
		
],[																						//台1高雄段
		// [22.656615104497494, 120.30881782253226, "大順自由路","號誌",,"號誌"],//非台一
		[22.654436186505425, 120.30357054179292, "台1高雄_博愛龍德路口"],
		[22.654816611256848, 120.3075526590111, "好市多"],
		[22.65526599344807, 120.30870647566398, "自由路"],
		[22.655279527232622, 120.31061237140867, "彎56"],
		[22.656295486293576, 120.31081243753817, "龍德新路", "路口",,"路口"],
		[22.655493701401024, 120.31541457156159, "民族路","號誌",,"號誌"],
		[22.649777978147927, 120.32414352266113, "建功路","號誌",,"號誌"],	
		[22.64149660280982, 120.32718990342501, "覺民路(大順禁左轉)","路口"],
		[22.640746998803735, 120.33030677899511, "臥龍路", "路口"],
		// [22.639148060257018, 120.32797290769224, "大順路",,,"號誌"],
		[22.638814888950794, 120.32989061927688, "臥龍路"],
		[22.638475881063112,120.33162334330774, "測速","測速"],
		[22.636279400935546, 120.34443647973721, "澄清路","號誌",,"號誌"],
		[22.637814021315773, 120.34815701797821, "文濟路","號誌",,"號誌"],
		[22.63634876160687, 120.35721342010389, "文衡路","號誌",,"號誌"],
		[22.63522911241938,120.36336004158221, "測速3", "測速"],
		[22.63413212059094, 120.37012392539445, "彎3"],
		[22.635421093866388, 120.37318949926723, "彎2"],
		[22.63635369740717, 120.38229941534014,"彎1"],
		[22.63385811106836, 120.38797010236682, "彎6"],
		
		[22.63405729798552, 120.38919031335351, "賓士路口","路口",,"路口"],
		[22.636104199865386, 120.39206782215768, "八德路","號誌",,"號誌"],
		[22.63938131993379, 120.40146185845819, "光明路","號誌",,"號誌"],
		[22.64018092324017, 120.40530035412054, "光明小路",,,"路口"],
		[22.640889767906486, 120.40878193206538, "測速A","測速"],
		[22.641547556176167, 120.41327831091964, "測速B","測速"],
		[22.642159446314253, 120.4185087722723, "磚仔窰","號誌",,"號誌"],
		[22.644811662781876, 120.42788668062792, "高屏橋西"],
		[22.649060457408485, 120.444090794445, "高屏橋東"]
		
	],[
		//台1屏北段
		[22.644811662781876, 120.42788668062792, "台1_高屏橋西"],
		[22.649060457408485, 120.444090794445, "高屏橋東"],
		[22.652129610229185, 120.45507473212501, "測速(可轉向)","測速",,"測速"],
		[22.654545853790143, 120.46379049366499, "450巷","號誌",,"號誌"],
		[22.655823532381984, 120.46656980548235, "建國路口","路口",,"路口"],
		[22.65425210140771, 120.47318992350883, "山隆巷"],
		[22.653656922272166, 120.47563281122031,"武成街"],
		[22.6529643293841, 120.4784366247958, "建南路g60R90","號誌",,"號誌"],
		[22.651762313125314, 120.48597167701199, "復興路","號誌",,"號誌"],
		[22.652838739424972, 120.49458501291548, "和生路567巷"],//中油彎道
		[22.654675275202116,120.49763292197711, "測速n越線","測速"],
		[22.654892831843018, 120.49793962803176, "工業六路","號誌",,"號誌"],
		[22.657599206003407, 120.50209948590671, "台1工業路","號誌",,"號誌"],
		[22.659860060390763, 120.50601741683295,"歸仁路","號誌",,"號誌"],
		
		[22.659911101873785, 120.51121459162805,"民生路","號誌",,"號誌"],
		[22.658034247616996, 120.5146302173418,"瑞光路口","號誌","s","號誌"],
		[22.655539129939942, 120.51901611238941, "果菜市場g120r40","號誌",,"號誌"],
		[22.65164196538594, 120.52577244459546,"測速n越線","測速"],
		[22.650677214478804, 120.52685860645906, "民族路"],
		[22.649322449799737, 120.52806492385191, "大同街g120r40"],
		[22.64284588050273, 120.5338488670412, "長安巷"],	
		[22.640091466178593, 120.5362835094121, "信義路", "路口","s"],
		[22.637586406499317, 120.53851589333695, "台1_內埔永豐路"],
				],[
														//屏東中段
		[22.633538679437965, 120.54216382730912, "台1內埔_人和路", "號誌",,"號誌"],
		[22.63049749570602, 120.545197147051, "新東路", "號誌",,"號誌"],
		[22.62608276572676,120.55197096207752,"測速05","測速"],
		[22.622862605834474, 120.55660160740435, "南寧路", "號誌",,"號誌"],
		[22.616662718550568, 120.55775531281208, "自強路", "號誌",,"號誌"],
		[22.608652841719344,120.55968243022917,"測速08","測速"],
		[22.608311309619182, 120.55979579548797, "復興路", "號誌",,"號誌"],
		[22.602662517383028, 120.56114394122493, "學人路", "號誌",,"號誌"],
		[22.599571823220582,120.55972752051989,"測速11",,,"測速"],
		[22.5951905792684, 120.55740095893346, "四維路內埔", "號誌",,"號誌"],
		[22.582267818066565,120.5487089171538,"測速16","測速"],
		[22.578510182409005, 120.54630453429209, "公正路", "號誌",,"號誌"],
		[22.572203860561462, 120.54403456039634, "潮州路", "號誌",,"號誌"],
		[22.56799007512012, 120.54397646040196, "彎東港溪"],
		[22.564878446277607, 120.54738283960205, "彎頭溝水橋"],
		[22.56175842499012, 120.55350227707396, "四維路潮州", "號誌",,"號誌"],
		[22.55939780507943, 120.55600847239336, "彎s2"],
		[22.552586814538408,120.5557192056855,"測速19","測速"],
		[22.550797510648323, 120.55559716493131, "三林路", "號誌",,"號誌"],
		[22.542095958863367, 120.55440286502957, "彎三星路"],
		[22.539989581824372, 120.54997334105612, "三城路", "號誌",,"號誌"],
		[22.539552101905297, 120.54875264383196, "光華路", "路口"],
		[22.536464658255557, 120.54002527701802, "台1_光春路潮州"]
		
	],[
																							
		// [22.98482402196842, 120.21112548826888, "大同路","路口",,"路口"]
		[22.988964914094694, 120.20765672145865, "南市_開山路"],
		[22.98903709598085, 120.20460864379818, "南門路"],
		[22.989942829042207, 120.20035038209184, "永福府前","路口",,"路口"],
		[22.992251798658174, 120.20084298579434, "永福路","路口",,"路口"],
		[22.992738588587297, 120.1986183361251, "中正路","路口",,"路口"],
		[22.990429445535817, 120.1978096970032, "府前路"],
		[22.987401089922763, 120.19753782949647, "永華路"],
		[22.986333154748692, 120.19755594081165, "樹林街"],
		[22.98509651438787, 120.19757565593272, "西門路","路口",,"路口"],
		[22.985122671604636, 120.1963768943332, "南寧街","路口",,"路口"],
																							//陳家伏苓糕
		[22.983843349737928, 120.19645067939489, "國華街","路口",,"路口"],
		[22.983868041971245, 120.19566450015733, "115巷"],
		[22.98384952235901, 120.19501272336689, "府緯街","路口",,"路口"],
		[22.981469740961604, 120.19509075977518,"建康路","號誌",,"號誌"],
		[22.978259966041534, 120.19517997846175,"新興路","號誌",,"號誌"],
		[22.97493278871515, 120.19537816526025, "大成路","號誌",,"號誌"],
		[22.967216509000707, 120.19540367809161, "新都路","號誌",,"號誌"],
		[22.96231716768313, 120.19546142030968, "中華路","號誌",,"號誌"],
		[22.961165429105247, 120.19547765516063, "863巷"],
		[22.96022120434109, 120.19546926409944, "827巷"],
		[22.95881038307809, 120.19547078885118,"興隆路","號誌",,"號誌"],
		[22.956636175775763, 120.19547730101853, "699巷"],
		[22.95406782693775, 120.19549118629797, "730巷"],
		[22.950640762528238, 120.19551016636548, "503巷"],
		[22.949008290285736, 120.19551705096191, "490巷"],
		[22.93911255293149, 120.19556448857217,"萬年路","號誌",,"號誌"],
		[22.932626829740283, 120.19559510868507,"台南永成路南_台86"],
	],[
																						//175白河到關嶺
																						
		[23.34664154892772, 120.40923291021235, "南172西白河_彎93"],																				
		[23.34540737783434, 120.4123478885672, "中山路南165","路口",,"路口"],
		[23.344650009974295, 120.41603214230916, "彎91"],
		[23.345091472969475, 120.4172830892249, "康樂路", "路口",,"路口"],
		[23.346798161978036, 120.42053218813966, "彎90"],
		[23.345270162868264, 120.42735830113021, "東河西", "號誌",,"號誌"],
		[23.34726304858996, 120.43948357733692, "白河交"],
		[23.34736177842498, 120.4447239149028,"東河東", "號誌",,"號誌"],
		[23.35037578490617, 120.45197534909033, "虎子墓01", "號誌",,"號誌"],
		[23.352307148834168, 120.46367140205685,"車道縮減虎子墓02", "號誌",,"號誌"],
		[23.352295278291262, 120.46795001308695, "南98白河水庫", "號誌",,"號誌"],
		[23.351997788342075, 120.4710576188271, "急彎2","急彎",,"急彎"],
		[23.345975279208922, 120.47300827746007, "仙大路外環", "號誌",,"號誌"],
		
		[23.344536783584005, 120.47493729997255, "南172乙仙草", "號誌",,"號誌"],
		[23.34257588640918, 120.480608065676,  "彎61"],
		[23.343267603371697, 120.48206935416853,  "彎62"],
		[23.341452572333285, 120.48434695450898,  "彎63"],
		[23.342352466844307, 120.48837449885654,  "彎64"],
		[23.34175221877526, 120.49224394793497,  "彎65"],
		[23.340894062780535, 120.49325621658606,  "彎66"],
		[23.34166239670377, 120.49533245821988,  "彎67"],
		[23.340442014099377, 120.49721221372484,  "彎68"],
		
		
		[23.340355027385485, 120.49928365378014, "捷徑下", "路口"],
		[23.340394208290128, 120.50096360483901,  "急彎A1","急彎"],
		[23.338389361000225, 120.49915942867383,  "彎14"],
		[23.33666093421136, 120.4994215213416,  "彎16"],
		[23.3347303873146, 120.49986473073986,  "彎18"],
		[23.333887787226683, 120.49957368556672,  "彎20"],
		[23.33292378360401, 120.50166878798557,"彎22"],
		[23.334149222954125, 120.50311720366186, "捷徑上", "路口"],
		
		[23.33385015664403, 120.5033061215673, "頂關子嶺"],
		[23.333973582855815, 120.50394838922603, "巷44"],
		[23.33248334024646, 120.50568363045694, "巷46"],
		[23.33209976078922, 120.50493159843747, "巷48"],
		[23.331817146116613, 120.50516293896632, "巷50"],
		[23.331903346734066, 120.50528028561139, "景大"],
		
		[23.33385015664403, 120.5033061215673, "頂關子嶺(重覆)"],
		[23.33638531525768, 120.50398936957284, "彎33"],
		[23.337974916520405, 120.50308434242429, "彎34"],
		[23.339344792930895, 120.50313343078629, "彎35"],
		
		[23.337751346472697, 120.50537706769376, "彎37"],
		[23.342090346811354, 120.50372659572749, "南175", "路口",,"路口"],
		[23.341476178144084, 120.5024458216987, "彎77"],
		[23.340419604980966, 120.50247185780395, "同翠橋"],
		[23.340355027385485, 120.49928365378014, "關嶺_捷徑下重覆"]
	]];
	
	
	var taskID = 2;
	// var DEBUG = true;
		var DEBUG = false;
	var points = [];
	//var mapPoints = [];
	var taskTitle = "";
	var zoom = -1;
	
	var nextPoint = 0;	//下一個點
	var Point01 = [22.659517486714293,120.51431010230766, "田中巷"];	
	var Point02 = [22.66613321392555, 120.50085349955407,"一樓"];
	var Point03 = [22.6243669, 120.7148054, "管制站"];
	var recentPoint = Point03;
	var edgeVector = -1;
	var coords_heading = -1;	//最近一次的GPS方向
	var coords_speed = -1;
	//上一個通過的點
	var passPoint = [0,0];
		passPoint[0] = recentPoint[0];
		passPoint[1] = recentPoint[1];
		
	var zoom0 = -1;
	var zoom1 = -1;
	
	var centerCoords0 = [23,120.5];
	var centerCoords = [23,120.5];
	
	var nextDist = 0;
	var shadowDist = -1;
	var preDist = 0;
	var incDistCnt = 0;
// var heading = -1;	//目標的方向0~360(以前一目標計算,但初值以移動點計算)
	var pathAngle = -1;
	// 尋標,新任務或去回程切換時要開啟, 有GPS的狀態時依據當前座標找到最近點
	var searchPoint=true;
	
	var receGap = 0;
	var prevGap = 0;
	//路徑的順逆向,逆向為-1(路徑數據以向南及向東為順向)
	var vector = 1;	
	/** 一般提醒*/
	var enAlarm = true;
	/** 高速提醒*/
	var enAlarmHigh = true;
	
	var canvas = document.getElementById("canvas");
	//canvas.addEventListener("click", click, false);

    canvas.addEventListener('mousedown',mouseDown);
	canvas.addEventListener('mousemove',mouseMove);
	canvas.addEventListener('mouseup',mouseUp);
	
	canvas.addEventListener('touchstart',touchStart);
    canvas.addEventListener('touchmove',touchMove);
    canvas.addEventListener('touchend',touchEnd);

	var enGestures = false;
	
	var ctx = canvas.getContext("2d");

	canvas.width = 950;canvas.height = 950;		//寬高預設值為300×150
	// canvas.width = window.innerWidth;
	// canvas.height = canvas.width;
	var centerX = canvas.width  / 2;
	var centerY = canvas.height / 2;
	

	//var scrPoint = gps2scr(recentPoint);
	const voice = new Audio();
	//voice.volume = 0.5;//預設值為何?

	 var startGestX = -1;
	var startGestY = -1;

	var oldClickTimes = -1;
	var viewMode = 1;
	
	var ins = document.getElementById("insertCoord");

	class TODO {}// function TODO(){}
	var _todo = new TODO();
	_todo._500資料檔案化_匯出_匯入= function(){}	//
	class canvas01{}
	var myCanvas = new canvas01();
	
	class map01{}
	var myMap = new map01();
	
	class control01{}
	var myCtl = new control01();
	/**
		
	*/
	function test02(){
		strGPS = strGPS.substr(1,3)+strGPS.substr(0,1);
		console.log(strGPS.substr(0,1));
		
	p0=	[22.665588375791046, 120.50101392899106,""];
		// [22.66654286222146, 120.50113602621077,"民利35巷"],
		p1=[22.665285944517155, 120.50179304264677,"殺蛇橋"];
		p2 = [22.66608654077297, 120.50036725372237,"工業路"];
	angleOffset(p0,p1,p2);
	}

function getAzimuth(p0, p1){
	d1y = getDistance([p1[0],p0[1]],p0);
	if(p1[0] < p0[0]){
		d1y *= -1;
	}
	d1x = getDistance([p1[0],p0[1]],p1);
	if(p1[1] < p0[1]){
		d1x *= -1;
	}
	//geometric angle幾何角度
	ga = Math.atan2(d1y,d1x);
	ga = Math.PI/2 - ga;
	if(ga < 0){
		ga += Math.PI*2;
	}
	return ga * 180/Math.PI;	//轉方位角0~360
}

function angleOffset(p0,p1,p2){		
	a1 = getAzimuth(p0,p1);
	a2 = getAzimuth(p0,p2);
	dA = Math.abs(a1 - a2);

	if(dA > 180){
		dA = 360 - dA;
	}
	//(dA*180/Math.PI
	return dA;
}
	
	function test03(){
		p=[	[22.66654286222146, 120.50113602621077,"民利35巷"],
			[22.665285944517155, 120.50179304264677,"殺蛇橋"],
			[22.66608654077297, 120.50036725372237,"工業路"],
			[22.6684552313614, 120.5042532586352, "伊谷"],
			[22.668182980030384, 120.50013875013059,"泳池"]
			];
			a1 = getAzimuth(p[0], p[1]);
			if(true){

					d1 = Math.PI/2 - a1;
				if(d1 < 0){
					d1 += Math.PI*2;
				}
						
			}else{
				d1 = -a1 -(-Math.PI/2);
				
				if( d1 > Math.PI*2 ){
					d1 -= Math.PI*2;
				}
			}
			d1 *= 180/Math.PI;
console.log(a1, d1);
			
			
	}
	function test01(){
			p=[	[22.66654286222146, 120.50113602621077,"民利35巷"],
			[22.665285944517155, 120.50179304264677,"殺蛇橋"],
			[22.66608654077297, 120.50036725372237,"工業路"]];
	pp = [[,],[,],[,]];
	
	console.log(Math.atan(-1));
	pp[1][0] = p[0][0];
	pp[1][1] = p[1][1];
	// per1=	(p[1][1]-p[0][1]) / (p[1][0]-p[0][0]);
	per1=	getDistance( pp[1],p[0]) / -getDistance(pp[1],p[1]);
	
	an1 = Math.atan(per1);
		an1 = Math.atan2(-getDistance(pp[1],p[0]),getDistance( pp[1],p[1]))
	console.log(per1,an1);
	
	pp[2][0] = p[0][0];
	pp[2][1] = p[2][1];
	// per1=	(p[1][1]-p[0][1]) / (p[1][0]-p[0][0]);
	per2=	getDistance( pp[2],p[0]) / getDistance(pp[2],p[2]);
	an2 = Math.atan(per2);	

	console.log(per2,an2);
	// alert("stop!");

		
	}
	
function init(){
// console.log("init(s)");
	// nextDist = 3.234;
	// showMsg(Math.round(nextDist));
	// showMsg(nextDist.toFixed());
		//file://即使同意, 仍然禁止
	/*
	if ('Notification' in window) {
		Notification.requestPermission(function(status){
			console.log('User Choice', status);
			if (status !== 'granted') {
				console.log('推播允許被拒絕了!');
			} else {

			}
		});
	new Notification('訂閱成功！！！');
	}
	*/

	startGPS();
	//保存最後任務編號
	 taskID = localStorage.taskID ? localStorage.taskID : taskID;
	initTask();
	// nearPoint();//	無GPS時測試用。
	newSpace();

	// startGPS();
	noSleep();	//note 9 上, chrome 92.0.4515.131有效, 三星16.2.1.56無效

	myCanvas.drawClearMap();
	myCanvas.drawBaseMap();
		nextDist = getDistance(recentPoint,  points[nextPoint]);
		newDist2 = Math.cos(2*Math.PI *150/360 - Math.atan((recentPoint[1]- points[nextPoint][1])/(recentPoint[0] - points[nextPoint][0])))*nextDist;
	//console.log(nextDist + ", " + newDist2);
	// showData();
// console.log("init(e)");
}

function insertCoord(coordType){
	//	新增點, 插入陣列內, 陣列滙出, 5種新增鈕
	//console.log("insertCoord()");
		//document.getElementById("watchStr").innerHTML= output;
	playVoice('當');
	strtmp =  recentPoint[0]+','+recentPoint[1] + ',"自訂點","'+
		coordType +	'",' + points[nextPoint][2]+	'~';
	try{
	strtmp += points[nextPoint-vector][2] ;
	}catch(e){
		strtmp += "null";
	}
	var now = new Date();
		strtmp += ","+	now.getDate()+"_"+now.getHours()+":"+now.getMinutes() +":"+ now.getSeconds() +"<br/>" ;
		// console.log(strtmp);
		
	// if (typeof (Storage) != "undefined"){
        // if (localStorage.insertCoord != "undefined"){
            //msg.innerText = localStorage.playVolume;
			localStorage.insertCoord = strtmp + localStorage.insertCoord;
            ins.innerHTML = localStorage.insertCoord;
		// }
	// }
	// }
	//showMsg(recentPoint[0].toFixed(7)+","+recentPoint[1].toFixed(7));
}

function newSpace(){	
/**計算適當的繪圖位置
	找出所有點分佈範圍的邊界值, 算中心點及比例
*/
 /*
 for(p in points){
	points[p][0] = Math.round(points[p][0], 5);
	points[p][1] = Math.round(points[p][1], 5);
 }
 */
 	//找出四邊的點以算出放大值zoom
var maxN = points[0][0];
var maxS = points[0][0];
var maxE = points[0][1];
var maxW = points[0][1];

for(p in points){
	if(points[p][0] > maxN) maxN = points[p][0];
	if(points[p][0] < maxS) maxS = points[p][0];
	if(points[p][1] > maxE) maxE = points[p][1];
	if(points[p][1] < maxW) maxW = points[p][1];
}

	if((maxN - maxS) >(maxE - maxW)){	//比較長與寛,較大者的拿來算比例
		zoom = canvas.height * 0.9/(maxN - maxS);
	}else{
		zoom = canvas.width * 0.9/(maxE - maxW);
	}
	zoom0 = zoom;
	centerCoords0[0] = (maxN + maxS)/2;
	centerCoords0[1] = (maxE + maxW)/2;

	centerCoords[0] = centerCoords0[0];
	centerCoords[1] = centerCoords0[1];
}

function touchStart(e){
	gesturesStart(e.targetTouches[0].pageX,e.targetTouches[0].pageY);
	e.preventDefault();//避免觸發 click()
}

function mouseDown(e){
	gesturesStart(e.pageX, e.pageY);
	e.preventDefault();
}

function gesturesStart(x,y){
//	showMsg("gesturesStart()");
		//手勢起始位置在九宮格中央才會運作
		var recentTime = new Date().getTime();
		
		if(x > canvas.width/3 && x <canvas.width*2/3 && y > canvas.height/3 && y < canvas.height*2/3){
				//上一行以乎可以用inner區塊的方法
			if(recentTime - oldClickTimes < 300){		//double click的間隔
				//縮放模式
				enGestures = true;
//				console.log("enGestures=" + enGestures);
				zoom1 = zoom;
				//ctx.beginPath();
				//ctx.moveTo(x, y);
				startGestX = x;
				startGestY = y;
			}else{
				//移動模式
			
			}
		}
		//移動
}

	var endGestX = -1; 
	var endGestY = -1;
function gesturesMove(x, y){
//	showMsg("gesturesMove()");
	endGestX = x;
	endGestY = y;
	if(enGestures && zoom>= zoom0/3){		//縮小不能小於1/3。那放大呢???
		 myCanvas.drawClearMap();
		 zoom =zoom1 *(1+(y-startGestY)*0.01);
		 if(zoom < zoom0/3)zoom = zoom0/3;
		 myCanvas.drawMiddleCross();
		 myCanvas.drawBaseMap();
	 }
}

function touchMove(e){
	gesturesMove(e.targetTouches[0].pageX,e.targetTouches[0].pageY);
	e.preventDefault();
}

function mouseMove(e){
	gesturesMove(e.pageX,e.pageY);
	e.preventDefault();
}

function gesturesEnd(){
	if(enGestures){
		enGestures = false;
	}else{
		gridCmd(endGestX, endGestY);
	}
}

function touchEnd(e){
	gesturesEnd();
	e.preventDefault();
}

function mouseUp(e){
	gesturesEnd();
	e.preventDefault();
}

async function noSleep(){	
//不自動休眠, Note9 chrome 92.0.4515.131有效, 但三星browser 16.0.6.23無作用。
	// The wake lock sentinel.
	let wakeLock = null;
	// Function that attempts to request a screen wake lock.
	const requestWakeLock = async () => {
		try {
			wakeLock = await navigator.wakeLock.request('screen');
			wakeLock.addEventListener('release', () => {
				//console.log('Screen Wake Lock was released');
			});
		//console.log('Screen Wake Lock is active');
		//alert("NoSleep");
		} catch (err) {
			console.error(`${err.name}, ${err.message}`);
		}
	};
	// Request a screen wake lock…
	await requestWakeLock();
}


function click(e){	//觸發座標為滑鼠放開處
	e.preventDefault();
	document.getElementById("watchStr").innerHTML="click()";
	//var x = event.pageX;
	//var y = event.pageY;
	gridCmd(e.pageX, e.pageY);
}

function gridCmd(x,y){
	if(document.getElementById("touchSW").checked){
		
	}else{
		return;
	}
//showMsg("gridCmd(), x=" + x +", y=" +y);
	var gridW = canvas.width/3;
	var gridH = canvas.height/3;
	oldClickTimes = new Date().getTime();
	
	if(x > gridW*2 && x < canvas.width-50 && y > gridH*2){	//右下角
	//&& x < canvas.width-50 用來避免note 9 的圓邊誤觸
		// taskID ++;
		if (++taskID == tasks.length) {
			taskID = 0;
		}
		nextPoint = 0;
		initTask();
		playVoice("當");
		return;
	}

		if(x > gridW*2 && x < canvas.width-50 && y < gridH){//右上角
			//&& x < canvas.width-50 用來避免note 9 的圓邊誤觸

			if(skipPoint()){	//手動跳一點, 差太多點則切換方向重找最近點
				playVoice("跳過");
				// edgeVector = getAzimuth(points[nextPoint-vector],  points[nextPoint]);
				showData();
			}else{
				showMsg("端點");
				searchPoint = true;
			}
				//
			// searchPoint = true;
			return;
		}
		
		if(x < gridW && x > 50 && y < gridH){//左上角
			//console.log("左上角_去回切換");
			vectorMode();
			return;
		}
		
		if(x < gridW && x > 50 && y > gridH*2){	//左下角
			//console.log("左下角_測試音效");
			viewSW();
			return;
		}
	}

function vectorMode(){
	
	vector *=-1;
	nextPoint += vector;
	if(nextPoint == -1 || nextPoint == points.length){
		showMsg("vectorMode():端點");
	}else{
		const vStr = ["回程",,"去程"];
		playVoice(vStr[1+vector]);
		showData();
	}
}

function vectorMode_(){
	if(vector ==1){
		vector = -1;//回程
		nextPoint = points.length-1;
		playVoice("回程");
	}else{
		vector = 1;//去程
		nextPoint = 0;
		playVoice("去程");
	}
	// searchPoint =true;
	showData();
}

function viewSW(){
	viewMode *= -1;		//兩種模式切換
		myCanvas.drawClearMap();
	if(viewMode == 1){
		playVoice("全圖");
		centerCoords[0] = centerCoords0[0];
		centerCoords[1] = centerCoords0[1];
		zoom = zoom0;
	}else{		
		playVoice("置中");
		centerCoords[0] = recentPoint[0];
		centerCoords[1] = recentPoint[1];
		myCanvas.drawMiddleCross();
	}

	myCanvas.drawBaseMap();	
}

function playVoice(str){
	//語音來源：22/1/30雅婷文字轉語音下載wav檔, https://tts.yating.tw/
	//其它：google翻譯,可透過SoundOfText網站下載, 或自己用DevTools下載mp3
	if(str == undefined) return ;
	
	var fileName = "../voice/"+ str+".wav";
		voice.src = fileName;
		_todo._750找不到語音檔要報錯_並播放其它 = function(){}	//AAAAAAAA
		try {
			voice.load();
			voice.play();
		}catch (e) {	//完全抓不到error
			showMsg(e);
		}
}

function initTask(){
	//任務切換
	//nextPoint = 0;
	nextDist = -1;
	preDist = 0;
	incDistCnt = 0
	vector = 1;
	viewMode = 1;

	localStorage.taskID = taskID;
	// taskID = localStorage.taskID ? localStorage.taskID-1 : taskID;
	

	points = tasks[taskID];
	
	newSpace();
	myCanvas.drawClearMap();
	myCanvas.drawBaseMap();
	
	showData();
}	

function skipPoint(){
	if(nextPoint == -1 || nextPoint == points.length){
		return false;
	}
		// try{
	enAlarm = true;
	enAlarmHigh = true;

	passPoint[0] = points[nextPoint][0];
	passPoint[1] = points[nextPoint][1];
		
	nextPoint += vector;
	
	if(nextPoint == -1 || nextPoint == points.length){

		return false;
	}else{

		edgeVector = getAzimuth(points[nextPoint-vector],  points[nextPoint]);
		return true;
	}
}	

myCanvas.drawClearMap = function (){
	ctx.fillStyle = "black";	//填滿色
	ctx.fillRect(0,0,canvas.width,canvas.height);
	ctx.strokeStyle = "blue";	//線條色
	ctx.lineWidth = 2;	//線條粗度
	ctx.strokeRect(0,0,canvas.width,canvas.height);
	ctx.strokeRect(canvas.width/3,canvas.height/3,canvas.width/3,canvas.height/3);
}

myCanvas.drawMiddleCross = function(){
				//在畫面中央畫十字
		ctx.strokeStyle = "white";	//線條色
		ctx.lineWidth = "2";	//線條粗度
		ctx.beginPath();
		ctx.moveTo(centerX-20, centerY);
		ctx.lineTo(centerX+20, centerY);
		ctx.moveTo(centerX, centerY-20);
		ctx.lineTo(centerX, centerY+20);
		// start = Math.PI*(evt.coords.heading/180 - 0.5);
		// ctx.arc( centerX, centerY,10,start,start-Math.PI*2,true);
		ctx.stroke();
	
}

myCanvas.drawBaseMap = function(){
	 var mapPoints = gps2scr(points);
	
     var circle = new Path2D();		//綠色節點
	 var circle0 = new Path2D();	//紅色節點, 有語音者
	 var circle2 = new Path2D();	//所有節點中間填滿黑色
	 var path = new Path2D();
	 var circleTmp;
	 
 	for ( p=0;p< mapPoints.length;p++){		//TODO 改用Path2D物件
		if(points[p][4-vector]){
			circle0.moveTo(mapPoints[p][0], mapPoints[p][1]);
			circle0.arc(mapPoints[p][0], mapPoints[p][1],1,0,Math.PI*2,true);
					circle2.moveTo(mapPoints[p][0], mapPoints[p][1]);
		circle2.arc(mapPoints[p][0], mapPoints[p][1],1,0,Math.PI*2,true);
		}else{

					circle.moveTo(mapPoints[p][0], mapPoints[p][1]);
		circle.arc(mapPoints[p][0], mapPoints[p][1],1,0,Math.PI*2,true);
		}
			

		path.lineTo(mapPoints[p][0], mapPoints[p][1]);
	}
	ctx.lineJoin="round";	//轉折點的樣式, miter(default), round扇形
	ctx.strokeStyle = "Lime";	//鮮綠色
	ctx.lineWidth = 2;	//線條粗度
	ctx.stroke(path);
	
	ctx.strokeStyle = "Magenta";	//  粉紅色
	ctx.lineWidth = 2;	//線條粗度
	// ctx.stroke(circle);
	
	ctx.lineWidth = 2;	//線條粗度
	ctx.stroke(circle0);
	
	  ctx.lineWidth = 2;	//線條粗度
	ctx.fillStyle = "black";
	// ctx.fill(circle2);
	/*
	ctx.lineJoin="miter";	//轉折點的樣式, miter(default), round扇形 和 bevel三角形
ctx.miterLimit=5;		//最大斜接長度。斜接長度指的是在兩條線交匯處內角和外角之間的距離。

lineCap 線條端點的樣式, butt(default)方形, square 和 round圓形
setLineDash 方法和 lineDashOffset 屬性來制定虛線樣式
來源 https://kknews.cc/zh-tw/code/6azm5bl.html
	*/
}

function gps2scr(sourcePs){
	//經緯度座標「批次」轉螢幕座標
	//「假設」經緯度間隔等比例
	//但到時圖片貼上就偏了...
	var newPs=new Array();
	for(var i=0; i<sourcePs.length; i++){
		newPs[i] = new Array();
		newPs[i][0] =  (sourcePs[i][1] - centerCoords[1] )* zoom + centerX;
		newPs[i][1] = -(sourcePs[i][0] - centerCoords[0] )*zoom + centerY;
	}
	return newPs;
}

myCanvas.drawPoint=function (lat, lon, color, r){
	var drawX = (lon - centerCoords[1] )* zoom + centerX;
	var drawY = -(lat - centerCoords[0] )*zoom + centerY;
	//console.log(drawX + "," + drawY);
	ctx.strokeStyle = color;	//線條色
	ctx.lineWidth = "1";	//線條粗度
	ctx.beginPath();
    ctx.arc(drawX, drawY,r,0,Math.PI*2,true);
	ctx.stroke();
}

function nearPoint(mode){
	// showMsg("nearPoint():"+recentPoint+";"+tasks[0][0]);
	//從路徑上找到最近的下一目標點, 但可能是適當點的前一點

	var shortstDist = getDistance(recentPoint,  tasks[0][0]);
	var bigAng = 0;
	var bigPoint=0;
	var bigTask = 0;
	var oldTask = taskID;
						
	for(var t=0; t < tasks.length; t++){
		// console.log(tasks[t][0][2]);
		for(var i=1; i < tasks[t].length; i++){
			// console.log(recentPoint,  tasks[t][i]);
			dist = getDistance(recentPoint,  tasks[t][i]);
			ang = angleOffset(recentPoint, tasks[t][i-1], tasks[t][i]);
			if(ang > bigAng){
				nextPoint = i;
				taskID = t;
				bigAng = ang;	//與兩端夾角最大者
			}
			// if(dist < shortstDist){
				// shortstDist = dist;	//與端點距離最近者
				// nextPoint = i;
				// taskID = t;
			// }
		}
	}
	// if(mode){
		// nextPoint =bigPoint;
		// taskID = bigTask;
	// }

		if(taskID != oldTask){
			initTask();
			playVoice('新任務');
		}
		edgeVector = getAzimuth(points[nextPoint-vector],  points[nextPoint]);
			
			diff = Math.abs(coords_heading - edgeVector); 
			if(diff > 90 && diff < 270){
				vector *= -1;
			}
	// showMsg("最近距離:" + tasks[taskID][nextPoint][2]);
	// showMsg("最大角度:" + tasks[bigTask][bigPoint][2]+"~"+tasks[bigTask][bigPoint-1][2]+", " + bigAng.toFixed(2));
	//TODO 最近點不在任何路徑範圍內
}

function geoYes (evt){
	// showMsg("geoYes()");
	
	recentPoint[0] = evt.coords.latitude;
	recentPoint[1] = evt.coords.longitude;
	coords_heading = evt.coords.heading;
	coords_speed = evt.coords.speed;
	
	strGPS = strGPS.substr(1,3)+strGPS.charAt(0);
	
	if(searchPoint){
		nearPoint();
		searchPoint = false;
	}
	
	if(viewMode == 1){		//全圖：只畫點
		myCanvas.drawPoint(recentPoint[0], recentPoint[1], "white", 1);
	}else{		//置中：全重畫, 不畫點
		centerCoords[0] = recentPoint[0];
		centerCoords[1] = recentPoint[1];
		myCanvas.drawClearMap();
		myCanvas.drawMiddleCross();
		myCanvas.drawBaseMap();
	}
	
	//showMsg(",23");
	nextDist = getDistance(recentPoint,  points[nextPoint]);
	
	// angle1 = Math.atan((recentPoint[0]- points[nextPoint][0])/(recentPoint[1] - points[nextPoint][1]));
	// shadowDist = Math.cos(angle1- pathAngle) * nextDist;
	//投影距離無法適用較大的轉角, 還是要用分角線y=ax+b
	//cos為距節點的投影距離, 用sin則為與路徑中線的距離



	_todo._250判定脫離路線 = function(){}	//AAAAAAAA
	_todo._220搜尋新路線 = function(){}	//手動鈕, 用角度與距離搜尋
	_todo._230判定順逆向 = function(){}	//AAAAAAAA
	//需要判定的項目
	//1.通過點, 才能繼續導航
	//2.提醒,及高速提醒
	//3.路線切換 ???
	//4.沒在路線上不可亂報
	fcolor = "";
	if (nextDist > preDist ){	//遠離中
		if(nextDist < evt.coords.speed/1000 * 2 + 0.015 ){
			//近距離內(車速的2秒),判定為通過
			if(points[nextPoint][4-vector]){
				playVoice("通過");
				if( points[nextPoint][4] == "s"){
					searchPoint = true;
					return;
				}
			}
			
			if(skipPoint()){
				myCanvas.drawPoint(points[nextPoint][0], points[nextPoint][1], "white", 2);
				preDist = getDistance(recentPoint,  points[nextPoint]);
			}else{
			// nextPoint -= vector;
				// showMsg("端點");
				searchPoint = true;
				return;
			}
			
			// pathAngle =  Math.atan((passPoint[0]- points[nextPoint][0])/(passPoint[1] - points[nextPoint][1]));
		}else{
			fcolor = "color='red'";
		}
	}else{		//接近中
		
		// if(enAlarmHigh && nextDist < 2 && evt.coords.speed*3.6 >70){
						//時速70以上, 2公里前提醒一次
		vocStr = points[nextPoint][4-vector];
		if( vocStr == "交流道" && enAlarmHigh && nextDist < 2){
			playVoice(vocStr);
			enAlarmHigh = false;
		}
		/** 事前提醒*/
		//時速60公里 = 60x1000/60x60 = 60/3.6 = 16.6公尺/秒(步行4公里/小時)
		//車速每10公里提前2秒通知：
		//		120公里提前24秒, 33*24=792
		//		30公里時提前6秒通知,約8.1*6=48公尺。
		//		10公里,3秒,約4.1*3公尺,。
		//最後加12公尺給單車時,路中與路邊的距離補償用
		
		if(enAlarm ){
			minDist = evt.coords.speed/1000 * evt.coords.speed*3.6/10*2 + 0.015;
			if(nextDist < 0.05 || nextDist < minDist){
				playVoice(points[nextPoint][4-vector]);
				enAlarm = false;
			}
		}		
	}
	
	showData();
	preDist = nextDist;
}

function _geoNo(evt){
	/*
		TODO 本函式塞到 watchPosition內。
		限https? win10本機檔用Chrome可開允許,但仍取得失敗。 手機note9待測
		Only secure origins are allowed 安全來源才可用geo...
		https://kknews.cc/zh-tw/tech/4qgkxq2.html
	*/
	if(evt.code == 1){
		showMsg("GPS未允用！");
	}else{
		showMsg(evt.code + ", " + evt.message);
	}
}

var watchID;
function startGPS(){
	//showMsg("startGPS()");
	if (!navigator.geolocation) {
		showMsg("GPS不支援。");
		return;
	}

		// navigator.geolocation.getCurrentPosition( geoYes, geoNo);
	navigator.permissions.query({name:'geolocation'}).then(function(result) {
		//權限判斷以乎對重覆檢查GPS是否啟用沒有關聯。
		if (result.state == 'denied') {	//denied禁用, prompt詢問, granted允許
			showMsg("GPS禁用！");
		}
		result.onchange = function() {
		}
	});
	/*
	var options = {
	  enableHighAccuracy: true,	//高精度, 實測更新間隔約1秒, 否則約20秒。
	  timeout: 5000,						//在note9用chrome會Timeout expired。
	  maximumAge: 0						//快取的過期時間，單位是毫秒，設為0來禁用快取讀取。
	};
	*/
	watchID = navigator.geolocation.watchPosition(geoYes, 
		//就算成功, 但中途失敗不會告知?
		(evt) =>{
				if(evt.code == 1){
					showMsg("GPS沒開！");	//User denied Geolocation
					//失敗後就不管了, 如何每秒檢查一次?
				}else{
					showMsg(evt.code + ", " + evt.message);
					//2, Network location provider at 'https://www.googleapis.com/' : ERR_NAME_NOT_RESOLVED
				}
		}, {enableHighAccuracy: true});
}

function stopGPS(){
	navigator.geolocation.clearWatch( watchID );
	showMsg("GPS停止定位。");
}

function getDistance(coord1, coord2) {
	//兩座標間的距離, 傳回：單位公里, 小數點後三位
    //本函式來源 https://www.geodatasource.com/developers/javascript
	lat1	= coord1[0].toFixed(5);	//用小數5位算距離
	lon1= coord1[1].toFixed(5);
	lat2	= coord2[0].toFixed(5);
	lon2= coord2[1].toFixed(5);
	
    var radlat1 = Math.PI * lat1/180;
    var radlat2 = Math.PI * lat2/180;
    var theta = lon1-lon2;
    var radtheta = Math.PI * theta/180;
    var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
    if (dist > 1) {
        dist = 1;
    }
    dist = Math.acos(dist);
    dist = dist * 180/Math.PI;
    dist = dist * 60 * 1.1515;	//不明常數
    dist = dist * 1.609344 ;		//英浬轉公里

    return dist.toFixed(3);		//小數點後三位(四捨「六入」)
}
	var fcolor = "";
	var strGPS = "\|/-";	//
function showData(){
	// showMsg("showData:nextPoint=" + nextPoint);
	// try{
		str="";
		str += strGPS.charAt(0);
		voiceStr = points[nextPoint][4-vector];
		if(voiceStr){
			str += "[" + voiceStr + "]";
		}else{
			str += "[x]";
		}
		str += points[nextPoint][2];
		str += "，" + edgeVector.toFixed() + "度";
		
		str += "<br>距離：<font "+ fcolor+">" ;
		str += (nextDist < 1) ? (+ nextDist*1000+"</font>公尺") : (Math.round(nextDist)+"</font>公里");

		arriveSec =  nextDist*1000/coords_speed;
		if(arriveSec < 99){
			str += "(" + arriveSec.toFixed(0)+"秒)";
		}
		str += "<br/>GPS："+ (coords_speed*3.6).toFixed(1) + "公里，";	//原單位：米/秒
		str += Math.round(coords_heading) +"度";	//12點鐘方向為0, 順時針~360
		
		if(vector ==1){	//去程
			tmp0 = 0;
			tmp1 = points.length-1;
		}else{
			tmp0 = points.length-1;
			tmp1 = 0;
		}
		str += "<br>任務：" + points[tmp0][2] + " ~ " +points[tmp1][2];
		dA = angleOffset(recentPoint,passPoint,points[nextPoint]);
		str += "<br>夾角：" + dA.toFixed();
		document.getElementById("posStr").innerHTML=str;
	// }
	

		//str += "<br />距離：<br />時速：";

		// if(nextDist >1){
			
		// }else{
			// str += "，" + (nextDist*1000).toFixed() + "公尺，";
			// }
/*
	if(evt == undefined){
			str+= evt;
	}else{
		str += "，" + nextDist.toFixed(1)  + "公里，";
		
		arriveSec =  nextDist*1000/evt.coords.speed;
		if(arriveSec < 99){
			str += arriveSec.toFixed(0)+"秒。";
		}
		//alert(str);
		//str += "<br />位置：" + recentPoint[0] + ", "+ recentPoint[1];
		str += "<br/>時速："+ (evt.coords.speed*3.6).toFixed(1) + "公里。";	//原單位：米/秒
		str += "方向：" + Math.round(evt.coords.heading);	//方向為正北的順時針

	}
			if(vector ==1){
			tmp0 = 0;
			tmp1 = points.length-1;
		}else{
			tmp0 = points.length-1;
			tmp1 = 0;
		}
		str += "<br>" + points[tmp0][2] + " ~ " +points[tmp1][2];
	//	str += "("+ points[nextPoint][0] +", " + points[nextPoint][1];
		document.getElementById("posStr").innerHTML=str;
*/
// console.log("showData(e)");
}

var msgList = ["","","","",""];
var msgID = 0;

function  showMsg(str){
	msgList[msgID] = str;
	output = msgList[msgID] + "<br/>";

	for(i=msgID+1; i < msgList.length; i++){
		output += msgList[i] + "。";
	}
	for(i=0; i < msgID; i++){
		output += msgList[i] + "。";
	}
	// console.log(output);
	document.getElementById("watchStr").innerHTML= output;
	
	msgID --;	//新的訊息放前面
	if(msgID < 0){
		msgID = msgList.length - 1;
	}
}

function newCache(){
			cache.delete('.');
		cache.delete('index.html');
	//將"gps"快取中的key全部刪除
	/*
	caches.open('gps')
		.then(function(cache) {
			cache.keys()
			.then(function(keys) {
				keys.forEach(function(request, index, array) {
					cache.delete(request);
				});
			});
		});
	*/	
}

function displayNotification(){
    if('serviceWorker' in navigator){
        var options = {
            body: '歡迎進入30天PWA的世界'           
        };
        navigator.serviceWorker.ready
            .then(function(sw){
                sw.showNotification('訂閱成功！！！', options);
            })
    }  else{
		
	}
     
}

var IntervalID;
var isMarch = -1;
var march = document.getElementById("march");
var timeNum = [40,,60];	//TODO 連續號誌使用同一時序。轉向時兩個值互換。
var colorList = ["red",,"lime"];
/**紅綠燈讀秒, 時間到或用戶點選時會變色及重數 */

function swColor(){

	//初始綠色靜止秒數零, 按一下開始增加, 
	//按一下(記錄綠色秒數G3)變紅且從零增加,
	//再按一下(記錄G3R40)變綠且從零增加
	//跳點後,存檔G3R40G24,畫面回復初始狀態
	//看到燈號時按一下, 再按一下變更顏色,倒數, 下一點時間不同則要回復初始狀態
	if(!IntervalID){
		IntervalID = window.setInterval(( () =>  {
			//休眠狀態將回調函數放在隊列中,等瀏覽器再次打開的時候，一瞬間全部執行
			if(count < 0){
				isMarch *= -1;
				count = timeNum[1+isMarch];
				march.style.color = colorList[1+isMarch];
				// march.innerText = count;
			}
			march.innerText = count--;
			
		}	) , 1000);
		count = timeNum[1+isMarch];
		march.style.color = colorList[1+isMarch];
		march.innerText = count--;
	}else{
		isMarch *= -1;
		count = timeNum[1+isMarch];
		march.style.color = colorList[1+isMarch];
		march.innerText = count;
	}
}

	_todo._510紅綠燈記錄 = function(){}	
	_todo._520紅綠燈讀秒 = function(){}	
function exportCoord(){
//座標清單匯出檔案,再用Http_file_server傳到電腦
  var fileName = "a.csv";//匯出的檔名
  var data = ins.innerHTML;	//TODO 要把BR改成\n\r
  var blob = new Blob([data], {
    type : "application/octet-stream"
  });
  //實作一個標簽, 好像不正規。
  var href = URL.createObjectURL(blob);
  var link = document.createElement("a");
  document.body.appendChild(link);
  link.href = href;
  link.download = fileName;
  link.click();
}

//document.getElementById('input').click();
// document.getElementById("fileInput").onchange = () => {
  // const selectedFiles = [...fileInput.files];
  // console.log(selectedFiles);
// }

/**
	程式功能：手機/GPS, 於特定路線上目標點提示路況(提早放油門, 減少煞車)
	目標1：山路有坑洞與急彎要提前通知
		資料源：除用gmap取得座標,內建路徑, 移動中要即時記錄,儲存(小數後七位不夠)
			儲存：csv匯入indexDB, 插入, 匯出
				設定：5個按鈕直接顯示在畫面上, 開車者要去按。
					暫時方案：存到本地變數
		語音：先上網下載並cache。之後可自行錄音, 存到cache
				
		
	目標2：平面道路紅綠燈讀秒(先手動)
	目標3：提醒下交流道???
	
	必要條件：GPS沒開要持續watch, 中途沒GPS要提示, 卡住了
	
	錯誤處理：
		手機上的文字大小會變動???
*/
</script>
</html>