<!-- 程式碼範例  -->
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
	<title>TGOS MAP API (lite) 版範例</title>
	<!--呼叫TGOS MAP API (lite)-->
		<script src="https://wdms.epa.gov.tw/idms/_js/CoordTrans.js"></script>
	<script type="text/javascript" src="https://api.tgos.tw/TGOS_API/tgos?ver=2&AppID=x+JLVSx85Lk=&APIKey=in8W74q0ogpcfW/STwicK8D5QwCdddJf05/7nb+OtDh8R99YN3T0LurV4xato3TpL/fOfylvJ9Wv/khZEsXEWxsBmg+GEj4AuokiNXCh14Rei21U5GtJpIkO++Mq3AguFK/ISDEWn4hMzqgrkxNe1Q==" charset="utf-8"></script>
	<script type="text/javascript"> 
	//程式來源 https://api.tgos.tw/TGOS_MAP_API/docs/site/web/LiteInit
		var messageBox;		//訊息視窗物件	
		var pMap;			//初始化地圖物件
		
		//------------------------------須自行修改的參數,包含點位坐標,訊息視窗內容及圖示檔案來源設定------------------------------
		
		var infotext = '<B>內政部資訊中心</B><br>台北市松江路469巷4號';		//地標名稱及訊息視窗內容
		 var markerPoint = new TGOS.TGPoint(303895, 2773227);				//地標坐標位置
		
		// var markerPoint = new TGOS.TGPoint(23.3318885,120.5053049);
		// var markerPoint = new TGOS.TGPoint(120.5053049,23.3318885);
		var imgUrl = "https://api.tgos.tw/TGOS_API/images/marker2.png";	//標記點圖示來源
		
		//------------------------------若網頁介面依照範例網頁的預設設定,以下程式碼可不修改---------------------------------------
		function InitWnd()
		{
			//------------------初始化地圖--------------------
			var pOMap = document.getElementById("OMap");
			var mapOptiions = {
				scaleControl: false,		//不顯示比例尺
				navigationControl: true,	//顯示地圖縮放控制項
				navigationControlOptions: {	//設定地圖縮放控制項
					controlPosition: TGOS.TGControlPosition.TOP_LEFT,	//控制項位置
					navigationControlStyle: TGOS.TGNavigationControlStyle.SMALL	//控制項樣式
				},
				mapTypeControl: false		//不顯示地圖類型控制項
			};
//3857為Google座標
			pMap = new TGOS.TGOnlineMap(pOMap, TGOS.TGCoordSys.EPSG3826, mapOptiions);	//建立地圖,選擇TWD97坐標
			pMap.setZoom(11);				//初始地圖縮放層級
			pMap.setCenter(markerPoint);	//初始地圖中心點
			
			//------------------建立標記點---------------------
			markerImg = new TGOS.TGImage(imgUrl, new TGOS.TGSize(38, 33), new TGOS.TGPoint(0, 0), new TGOS.TGPoint(10, 33));	//設定標記點圖片及尺寸大小
			pTGMarker = new TGOS.TGMarker(pMap, markerPoint,'', markerImg);	//建立機關單位標記點
			
			//-----------------建立訊息視窗--------------------
			var InfoWindowOptions = {
				  maxWidth:4000,	//訊息視窗的最大寬度
				  pixelOffset: new TGOS.TGSize(5, -30),	//InfoWindow起始位置的偏移量, 使用TGSize設定, 向右X為正, 向上Y為負  
				  zIndex:99			//視窗堆疊順序
			};				
			messageBox = new TGOS.TGInfoWindow(infotext, markerPoint, InfoWindowOptions);	//建立訊息視窗							
			TGOS.TGEvent.addListener(pTGMarker, "mouseover", openInfoWindow);	//滑鼠監聽事件--開啟訊息視窗
			TGOS.TGEvent.addListener(pTGMarker, "mouseout", closeInfoWindow);	//滑鼠監聽事件--關閉訊息視窗
		}
		
		function openInfoWindow() {	//開啟訊息視窗函式
			messageBox.open(pMap);
		}
		
		function closeInfoWindow() {	//關閉訊息視窗函式
			messageBox.close();
		}
		
		var markerImg;
		var pTGMarker;
		function next(){
			geoYes();
			// markerPoint = new TGOS.TGPoint(199412, 2581121);				//景大WGS84轉TWD97
			// pMap.setCenter(markerPoint);	//初始地圖中心點
			
			// pTGMarker = new TGOS.TGMarker(pMap, markerPoint,'', markerImg);	//建立機關單位標記點

		}
		var pLL = [22.659517486714293,120.51431010230766];
		var pUTM =LatLon2UTM(pLL[0], pLL[1],0, 0);
		console.log(pUTM[0],pUTM[1]);	//200086, 2506662
		
		var 	watchID = navigator.geolocation.watchPosition(geoYes, 
		//就算成功, 但中途失敗不會告知?
		(evt) =>{
				if(evt.code == 1){
					console.log("GPS沒開！");	//User denied Geolocation
					//失敗後就不管了, 如何每秒檢查一次?
				}else{
					console.log(evt.code + ", " + evt.message);
					//2, Network location provider at 'https://www.googleapis.com/' : ERR_NAME_NOT_RESOLVED
				}
		}, {enableHighAccuracy: true});
	
	var pTGMarker;
	var pUTM;
	var pLL = [22.659517486714293,120.51431010230766];
	
	function geoYes (evt){
		console.log("geoYes()");
		 if(evt != undefined){
			pLL[0] = evt.coords.latitude;
			pLL[1] = evt.coords.longitude;
		}
		// pLL[0] += 0.0002;
		//轉換程式來源 https://wdms.epa.gov.tw/idms/coordtrans.htm
		//官方轉換 https://api.tgos.tw/TGOS_MAP_API/docs/site/web/Transform
		pUTM =LatLon2UTM(pLL[0], pLL[1], 0, 0);
		// console.log(pUTM[0],pUTM[1]);	//200086, 2506662
		
			pCenter = new TGOS.TGPoint(pUTM[0], pUTM[1]);
			pMap.setCenter(pCenter);	//初始地圖中心點
			
		// if(pTGMarker == undefined){
			 pTGMarker.setMap();
			 pTGMarker = new TGOS.TGMarker(pMap, pCenter,'', markerImg);
		// }else{
			
			//pTGMarker.setPosition(pUTM[0], pUTM[1]);
		// }
	}
</script>

</head>
<body style="margin:0px" onload="InitWnd();" onClick="next();">
011
	<div id="OMap" style="position:absolute_;浮動模式; top:5px; left:5px; width:900px; height:900px; border:1px solid #000000;"></div>
<input type="button" value="next" onClick="next();">
	</body>
</html>                            